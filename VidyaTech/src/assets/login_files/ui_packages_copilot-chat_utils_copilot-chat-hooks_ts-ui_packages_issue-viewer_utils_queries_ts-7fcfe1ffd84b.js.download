"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_copilot-chat_utils_copilot-chat-hooks_ts-ui_packages_issue-viewer_utils_queries_ts"],{66444:(e,t,s)=>{s.d(t,{L:()=>BlackbirdPermissionCaches});var r=s(43311),a=s(46335);let BlackbirdPermissionCaches=class BlackbirdPermissionCaches{async setupWarmCachesLoop(){(0,r.M3)()&&(BlackbirdPermissionCaches.warmCachesLoopSetup?await BlackbirdPermissionCaches.warm:(BlackbirdPermissionCaches.warmCachesLoopSetup=!0,await this.warmCaches()))}async warmCaches(){let e=54e4;try{let t=await (0,a.lS)("/search/warm_blackbird_caches",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),s=await t.json();e=new Date(s.userCacheExpiresAt).getTime()-Date.now()-3e4,(isNaN(e)||e<=5)&&(e=3e4)}catch{}BlackbirdPermissionCaches.warmResolve(),setTimeout(()=>{this.warmCaches()},e)}};BlackbirdPermissionCaches.warmCachesLoopSetup=!1,BlackbirdPermissionCaches.warm=new Promise(e=>{BlackbirdPermissionCaches.warmResolve=e})},22942:(e,t,s)=>{s.d(t,{J:()=>CopilotAuthTokenProvider});let AuthToken=class AuthToken{get authorizationHeaderValue(){return`GitHub-Bearer ${this.value}`}needsRefreshing(e){return this.isExpired||this.ssoChanged(e)}get isExpired(){let e=new Date(this.expiration);return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))<new Date(Date.now()+15e3)}ssoChanged(e){return!(this.ssoOrgIDs.every(t=>e.includes(t))&&e.every(e=>this.ssoOrgIDs.includes(e)))}static fromResult(e,t){return new AuthToken(e.token,e.expiration,t)}serialize(){return{value:this.value,expiration:this.expiration,ssoOrgIDs:this.ssoOrgIDs}}static deserialize(e){return new AuthToken(e.value,e.expiration,e.ssoOrgIDs)}constructor(e,t,s){this.value=e,this.expiration=t,this.ssoOrgIDs=s}};var r=s(10943),a=s(46335);let i="COPILOT_AUTH_TOKEN";let CopilotAuthTokenProvider=class CopilotAuthTokenProvider{async getAuthToken(){let e=this.getLocalStorageAuthToken();return e?this.validateAuthToken(e):this.fetchAuthToken()}setLocalStorageAuthToken(e){this.copilotLocalStorage.setItem(i,JSON.stringify(e.serialize()))}getLocalStorageAuthToken(){let e=this.copilotLocalStorage.getItem(i);return e?AuthToken.deserialize(JSON.parse(e)):null}async validateAuthToken(e){return e.needsRefreshing(this.ssoOrgIDs)?this.fetchAuthToken():e}fetchAuthToken(){return this.currentAuthTokenRequest||(this.currentAuthTokenRequest=this._fetchAuthToken()),this.currentAuthTokenRequest}async _fetchAuthToken(){let e=await (0,a.lS)("/github-copilot/chat/token",{method:"POST"});if(e.ok){let t=await e.json();this.currentAuthTokenRequest=null;let s=AuthToken.fromResult(t,this.ssoOrgIDs);return this.setLocalStorageAuthToken(s),s}throw this.currentAuthTokenRequest=null,Error("Failed to mint new auth token")}constructor(e){this.ssoOrgIDs=e,this.currentAuthTokenRequest=null,this.copilotLocalStorage=(0,r.A)("localStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5})}}},85749:(e,t,s)=>{s.d(t,{d:()=>ApiCache});let ApiCache=class ApiCache{async get(...e){let t=e.join(this.separator),s=this.cache.get(t);if(s)return s;{let s=this.fetchFn(...e);return this.cache.set(t,s),(await s).ok||this.cache.delete(t),s}}constructor(e){this.fetchFn=e,this.separator="-!-",this.cache=new Map}}},51315:(e,t,s)=>{s.d(t,{Bc:()=>i,fv:()=>n,uN:()=>a,wg:()=>r});let r="copilot-chat-textarea",a="copilot-chat-topic-search",i="Review",n="copilot-chat-header-button"},20772:(e,t,s)=>{s.d(t,{Ld:()=>m,M8:()=>_,Tz:()=>T,U2:()=>E,W5:()=>u,cx:()=>g,o6:()=>C,r_:()=>S,vn:()=>f,xG:()=>h});var r=s(97665),a=s(40458),i=s(94747),n=s(97286),o=s(46335),l=s(96540),c=s(3004),d=s(2982);s(26973);var u=function(e){return e.Unindexed="not_indexed",e.Indexed="indexed",e.Indexing="indexing",e.PartiallyIndexed="partially_indexed",e.Unknown="unknown",e}({}),h=function(e){return e.Requested="requested",e.NotFound="not_found",e.Unauthorized="unauthorized",e.ServiceUnavailable="service_unavailable",e.QuotaExhausted="quota_exhausted",e.Forbidden="forbidden",e.CanIndex="ok",e.IndexingError="indexing_error",e.RequestFailed="request_failed",e.Unknown="unknown",e}({});let p=["not_found","unauthorized","service_unavailable","quota_exhausted","forbidden","request_failed"],g=256,m=400;function E(e,t,s){let r=(0,l.useRef)(void 0),a=(0,l.useRef)(void 0),i=(0,l.useRef)([]),n=(0,l.useRef)(!1),[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)(!0),h=(0,l.useCallback)(()=>{c([]),u(!1)},[]),p=(0,l.useCallback)(()=>{if(s&&e)try{let e=new Worker(s);e.onmessage=({data:e})=>{n.current=!1,c(e.list),u(!1),a.current=e.query,i.current=e.list},r.current=e}catch(e){console.warn("Web workers are not available: ",e)}},[s,e]),g=(0,l.useCallback)(t=>{n.current&&(r.current?.terminate(),p());let s=a.current&&t.startsWith(a.current)&&i.current.length;u(!0),n.current=!0,r.current?.postMessage({baseList:s?i.current:e,query:t})},[e,p]);return((0,l.useEffect)(()=>(p(),()=>r.current?.terminate()),[p]),(0,l.useEffect)(()=>{g(t)},[t,g]),s)?[o,d,h]:[[],!1,()=>{}]}function _(e){var t,s;let n=(0,r.jE)(),o=(0,l.useCallback)(()=>Promise.all(e.map(e=>n.invalidateQueries({queryKey:["copilot-chat","repos-indexing-state",e]}))),[n,e]),c=(0,a.E)({queries:e.map(e=>({queryKey:["copilot-chat","repos-indexing-state",e],queryFn:()=>y(e),placeholderData:{requestStatus:"unknown",code:"unknown",docs:"unknown"},staleTime:1/0}))}),{mutate:d}=(0,i.n)({mutationKey:["repos-indexing-state"],mutationFn:()=>w(e),onSuccess:o}),u={requestStatus:0===(s=(t=c.map(e=>e.data)).map(e=>e.requestStatus)).length?"unknown":s.some(e=>p.includes(e))?"indexing_error":s.every(e=>"ok"===e)?"ok":(s.every(e=>"unknown"===e),"unknown"),code:R(t.map(e=>e.code)),docs:R(t.map(e=>e.docs)),remainingRepoIndexTokens:t[0]?.remainingRepoIndexTokens};return O(()=>void o(),"indexing"===u.code&&"indexing_error"!==u.requestStatus?1e4:0),[u,()=>d()]}function f(e){let t=(0,r.jE)(),s=(0,l.useCallback)(()=>Promise.resolve(t.invalidateQueries({queryKey:["repo-indexing-state",e]})),[t,e]),a=(0,n.I)({queryKey:["copilot-chat","repo-indexing-state",e],queryFn:()=>y(e),placeholderData:{requestStatus:"unknown",code:"unknown",docs:"unknown"},staleTime:1/0}),{mutate:o}=(0,i.n)({mutationKey:["repo-indexing-state"],mutationFn:()=>w([e]),onSuccess:s}),c=a.data;return O(()=>void s(),"indexing"===c.code&&"indexing_error"!==c.requestStatus?1e4:0),[c,()=>o()]}function S(e){let t=(0,n.I)({queryKey:["copilot-chat","repos-indexing-state",e],queryFn:()=>I(e),staleTime:1/0});return!t.isError&&!!t.data?.canChat}function T(){let e=c.J.getPanelHeight(),t=c.J.getPanelWidth(),s=(0,l.useRef)(null),r=(0,l.useRef)(e),a=(0,l.useRef)(e),i=(0,l.useRef)(null),n=(0,l.useRef)(t),o=(0,l.useRef)(t),[d,u]=(0,l.useState)(e),[h,p]=(0,l.useState)(t),E=(0,l.useRef)(0);(0,l.useEffect)(()=>{E.current=parseFloat(getComputedStyle(document.documentElement).fontSize)},[]);let _=e=>Math.min(Math.max(e,g),window.innerHeight-E.current),f=e=>Math.min(Math.max(e,m),window.innerWidth-2*E.current),S=(0,l.useCallback)(e=>{if(null!==s.current){let t=s.current-e.clientY,i=_(r.current+t);u(i),a.current=i}if(null!==i.current){let t=i.current-e.clientX,s=f(n.current+t);p(s),o.current=s}},[]),T=(0,l.useCallback)(()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",T),null!==s.current&&(c.J.setPanelHeight(a.current),s.current=null),null!==i.current&&(c.J.setPanelWidth(o.current),i.current=null)},[S]),C=(0,l.useCallback)((e,t,a)=>{0===e.button&&(e.preventDefault(),a&&(s.current=e.clientY,r.current=d),t&&(i.current=e.clientX,n.current=h),window.addEventListener("mousemove",S),window.addEventListener("mouseup",T))},[d,h,S,T]),y=(0,l.useCallback)(e=>{if("ArrowUp"===e.key){let t=_(d+4);u(t),c.J.setPanelHeight(t),e.preventDefault()}else if("ArrowDown"===e.key){let t=_(d-4);u(t),c.J.setPanelHeight(t),e.preventDefault()}else if("ArrowRight"===e.key){let t=f(h-4);p(t),c.J.setPanelWidth(t),e.preventDefault()}else if("ArrowLeft"===e.key){let t=f(h+4);p(t),c.J.setPanelWidth(t),e.preventDefault()}},[d,h]);return{panelWidth:h,panelHeight:d,startResize:C,onResizerKeyDown:y}}function C(e){let[t,s]=(0,l.useState)({}),r=(0,d.qY)();return(0,l.useEffect)(()=>{e&&(r?.current?.clientWidth||480)+480>=window.innerWidth?s({left:`${window.innerWidth-(r?.current?.clientWidth||480)}px !important`,bottom:"64px"}):s({})},[e,r]),t}async function y(e){let t=await fetch(`/search/check_indexing_status?nwo=${encodeURIComponent(e)}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)return{requestStatus:"request_failed",code:"unknown",docs:"unknown"};let s=await t.json();return{requestStatus:s.can_index,code:s.code_status,docs:s.docs_status,remainingRepoIndexTokens:s.remaining_repo_index_tokens}}async function w(e){let t=1===e.length?`nwo=${encodeURIComponent(e[0])}`:`nwos=${encodeURIComponent(JSON.stringify(e))}`;return(0,o.DI)(`/search/index_embeddings?${t}&index_code=true`,{method:"POST"})}async function I(e){let t=await fetch(`/github-copilot/docs/docsets/kb_indexed_repos?ids=${encodeURIComponent(JSON.stringify(e))}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});return t.ok?await t.json():{canChat:!1}}function R(e){return e.every(e=>"indexed"===e)?"indexed":e.every(e=>"not_indexed"===e)?"not_indexed":e.some(e=>"indexing"===e)?"indexing":e.some(e=>"not_indexed"===e)?"partially_indexed":"unknown"}function O(e,t){let s=(0,l.useRef)(void 0),r=(0,l.useRef)(e);return(0,l.useEffect)(()=>{r.current=e},[e]),(0,l.useEffect)(()=>{if(t>0)return s.current=window.setInterval(()=>r.current(),t),()=>window.clearInterval(s.current)},[t]),s}},64575:(e,t,s)=>{s.d(t,{X:()=>CopilotChatMessageStreamer});let r=/^data:\s+/;let CopilotStreamingError=class CopilotStreamingError extends Error{constructor(e){super(e.description),this.error=e,this.name="CopilotStreamingError"}};let CopilotChatMessageStreamer=class CopilotChatMessageStreamer{async *stream(){let e=new TextDecoder("utf-8"),t="";for(;;){let s,a;try{({value:s,done:a}=await this.reader.read())}catch{throw new CopilotStreamingError({type:"error",errorType:"networkError",description:"NETWORK_CONNECTION_INTERRUPTED"})}if(a)break;for(t+=e.decode(s);;){let e=t.indexOf("\n\n");if(-1===e)break;let s=t.slice(0,e).replace(r,"");if("[DONE]"===s)return;let a=JSON.parse(s);if(yield a,a?.type==="complete")return;t=t.slice(e+2)}}}async stop(){return this.reader.cancel()}constructor(e){this.reader=e}}},96335:(e,t,s)=>{s.d(t,{k:()=>CopilotChatService});var r=s(66444),a=s(22942),i=s(4227),n=s(46335),o=s(85749),l=s(38253),c=s(3004),d=s(94194);let u=new Set(["snippet","file","symbol","docset","repository"]);let CopilotChatService=class CopilotChatService{async fetchThreads(e={}){let t=new URLSearchParams;"string"==typeof e.name&&t.set("name",e.name);let s=`/threads?${t.toString()}`,r=await this.makeCAPIRequest(s,"GET");if(!r.ok)return r;let a=(await r.json()).threads||[];return{status:r.status,ok:!0,payload:a}}async fetchLatestThread(e){let t=new URLSearchParams;"string"==typeof e&&t.set("thread_id",e);let s=await this.makeCAPIRequest(`/threads/latest?${t.toString()}`,"GET");if(!s.ok)return s;let r=(await s.json()).thread;return{status:s.status,ok:!0,payload:r}}async createThread(){let e=await this.makeCAPIRequest("/threads","POST");if(!e.ok)return e;let t=(await e.json()).thread;return{status:e.status,ok:!0,payload:t}}async deleteThread(e){let t=await this.makeCAPIRequest(`/threads/${e}`,"DELETE");return t.ok?{status:t.status,ok:!0,payload:null}:t}async deleteAllThreads(e){let t=await this.makeCAPIRequest("/threads","DELETE",e);return t.ok?{status:t.status,ok:!0,payload:null}:t}async renameThread(e,t){let s=await this.makeCAPIRequest(`/threads/${e}/name`,"PATCH",{generate:!1,name:t});if(!s.ok)return s;let r=(await s.json()).name||"";return{status:s.status,ok:!0,payload:r}}async clearThread(e){let t=await this.makeCAPIRequest(`/threads/${e}/clear`,"PATCH");return t.ok?{status:t.status,ok:!0,payload:null}:t}async shareThread(e){let t=await this.makeCAPIRequest(`/threads/${e}/share`,"PATCH");if(!t.ok)return t;let s=(await t.json()).thread;return{status:t.status,ok:!0,payload:s}}async generateThreadName(e){let t=await this.makeCAPIRequest(`/threads/${e}/name`,"PATCH",{generate:!0,name:""});if(!t.ok)return t;let s=(await t.json()).name||"";return{status:t.status,ok:!0,payload:s}}async getSystemPrompt(e){let t=await this.makeCAPIRequest(`/system_prompt/${e}`,"GET");if(!t.ok)return t;let s=await t.json();return{status:t.status,ok:!0,payload:s}}async listMessages(e){if(this.listMessagesCache?.thread.id===e)return{status:200,ok:!0,payload:this.listMessagesCache};let t=await this.makeCAPIRequest(`/threads/${e}/messages`,"GET");if(!t.ok)return t;let s=await t.json();return this.listMessagesCache=s,{status:t.status,ok:!0,payload:s}}async listSharedThreadMessages(e){let t=await this.makeCAPIRequest(`/shared/${e}/messages`,"GET");if(!t.ok)return t;let s=await t.json();return{status:t.status,ok:!0,payload:s}}async createMessage(e,t,s,r,a,i){this.listMessagesCache=void 0;let n=await this.makeCAPIRequest(`/threads/${e}/messages`,"POST",{content:t,intent:s,references:r,currentURL:window.location.href,customInstructions:a,model:i,settings:c.J.settings??void 0});if(!n.ok)return n;let o=(await n.json()).message;return{status:n.status,ok:!0,payload:o}}async createMessageStreaming(e,t,s,r,a,i,n,o,l,d,u,h,p,g){this.listMessagesCache=void 0;let m={content:t,intent:s,references:a,context:i,currentURL:window.location.href,streaming:!0,confirmations:n,customInstructions:o,model:l,mode:r,settings:c.J.settings??void 0,customCopilotId:d,parentMessageID:u,tools:h,clientToolResults:p},E=this.processQueryParams(new URLSearchParams(window.location.search)),_=await this.makeCAPIRequest(`/threads/${e}/messages?${E.toString()}`,"POST",m,!0,void 0,g);return _.ok?{status:_.status,ok:!0,response:_}:_}processQueryParams(e){let t=["instruction_prompt"],s=new URLSearchParams;for(let[r,a]of e)t.includes(r)&&s.append(r,a);return s}async listModels(){let e=await this.makeCAPIRequest("/models","GET",void 0,!1,"");if(!e.ok)return e;let t=await e.json();return{status:e.status,ok:!0,payload:t.data}}async setModelPolicyState(e,t){let s=await this.makeCAPIRequest(`/models/${e}/policy`,"POST",{state:t},!1,"");if(!s.ok)return Promise.reject(Error(`Failed to update model policy state: ${s.status}`))}async sendFeedback({feedback:e,feedbackChoice:t,messageId:s,threadId:r,textResponse:a}){let i=await this.makeDotcomRequest(`${this.urlPathPrefix}/feedback`,"POST",{feedback:e,feedback_choice:t,message_id:s,thread_id:r,text_response:a});return i.ok?{status:i.status,ok:!0,payload:null}:i}async listDocsets(){let e=await this.fetchDocsetsResponse();return e.ok?{status:200,ok:!0,payload:e.payload.knowledgeBases}:e}async listAdministratedCopilotEnterpriseOrganizations(){let e=await this.fetchDocsetsResponse();return e.ok?{status:200,ok:!0,payload:e.payload.administratedCopilotEnterpriseOrganizations}:e}fetchDocsetsResponse(){return this.docsetsPromise||(this.docsetsPromise=this.docsetRequestPromise()),this.docsetsPromise}async docsetRequestPromise(){let e=await this.makeDotcomRequest("/github-copilot/docs/docsets","GET");return e.ok?{status:200,ok:!0,payload:await e.json()}:e}async deleteDocset(e){let t=await this.makeDotcomRequest(`/copilot/docsets/${e.id}`,"DELETE");return t.ok?{status:t.status,ok:!0,payload:null}:t}async listRepoFiles(e,t=!1){let s=(0,i.ClY)({repo:e,commitOid:e.commitOID,includeDirectories:t});return this.repoFilesCache.get(s)}async querySymbols(e,t){return await this.blackbirdCaches.setupWarmCachesLoop(),this.querySymbolsCache.get(e.ownerLogin,e.name,t)}async fetchImplicitContext(e,t,s){let r=await this.makeDotcomRequest(`${this.urlPathPrefix}/implicit-context/${t}/${s}/${encodeURIComponent(e)}`,"GET");return r.ok?{status:r.status,ok:r.ok,payload:await r.json()}:r}async fetchRepo(e){let t;if(this.repoDetailsCache.has(e))t=this.repoDetailsCache.get(e);else{let s=await this.makeDotcomRequest(`${this.urlPathPrefix}/repositories/${e}`,"GET");if(!s.ok)return s;t=await s.json(),this.repoDetailsCache.set(e,t)}return{status:200,ok:!0,payload:t}}async listAgents(e){let t=await (0,n.lS)(e);if(!t.ok)return{status:t.status,ok:!1,error:l.Sr[t.status]||l.DW};let s=await t.json();return{status:t.status,ok:t.ok,payload:s}}async listCustomCopilots(){let e=await (0,n.lS)(`${this.urlPathPrefix}/custom_copilots`);if(!e.ok)return{status:e.status,ok:!1,error:l.Sr[e.status]||l.DW};let t=await e.json();return{status:e.status,ok:!0,payload:t}}async hydrateReference(e){if(!u.has(e.type))return{status:204,ok:!0,payload:e};let t=await this.makeDotcomRequest(`${this.urlPathPrefix}/reference_details`,"POST",{reference:e});return t.ok?{status:t.status,ok:t.ok,payload:await t.json()}:t}async fetchLanguageForFileReference(e){let{repoOwner:t,repoName:s}=e,r=window.btoa(e.path),a=(0,i.RT3)({ownerLogin:t,name:s},r,!0),n=await this.makeDotcomRequest(a,"GET");return n.ok?{status:n.status,ok:n.ok,payload:await n.json()}:n}async makeDotcomRequest(e,t,s){let r={};for(let e of(0,d.f)()){let t=e.split("="),s=t[0]?.replaceAll("_","-"),a="1";t.length>1&&(a=t[1]),r[`X-Experiment-${s}`]=a}let a=await this.copilotAuthTokenProvider.getAuthToken();r["X-Copilot-Api-Token"]=a.value;try{let a=await (0,n.lS)(e,{method:t,body:s,headers:r});if(a.ok)return a;return{status:a.status,ok:!1,error:l.Sr[a.status]||l.DW}}catch{return{status:500,ok:!1,error:l.DW}}}get directConnectConfiguration(){return{integrationID:"copilot-chat"}}async makeCAPIRequest(e,t,s,r=!1,a="/github/chat",i){let n=this.apiURL,o=await this.copilotAuthTokenProvider.getAuthToken();return await (0,l.p)({basePath:n+a,path:e,method:t,body:s,streamingResponse:r,authToken:o,integrationId:this.directConnectConfiguration.integrationID,realIp:this.realIp,signal:i})}constructor(e,t,s){this.urlPathPrefix="/github-copilot/chat",this.docsetsPromise=void 0,this.repoDetailsCache=new Map,this.listMessagesCache=void 0,this.blackbirdCaches=new r.L,this.listRepoFilesImpl=async e=>{let t=await this.makeDotcomRequest(e,"GET");return t.ok?{status:200,ok:!0,payload:await t.json()}:t},this.repoFilesCache=new o.d(this.listRepoFilesImpl),this.querySymbolsImpl=async(e,t,s)=>{let r=await this.makeDotcomRequest(`/search/suggestions?query=repo:${e}/${t} ${s}`,"GET");return r.ok?{status:200,ok:!0,payload:(await r.json()).suggestions.filter(e=>"SUGGESTION_KIND_SYMBOL"===e.kind)}:r},this.querySymbolsCache=new o.d(this.querySymbolsImpl),this.apiURL=e,this.copilotAuthTokenProvider=new a.J(t.map(e=>e.id)),this.realIp=s||""}}},44036:(e,t,s)=>{function r(e){let t={id:"root",role:"user",createdAt:"",threadID:"",references:null,childMessages:[]};if(0===e.length){e.push(t);return}"root"!==e[0].id&&e.unshift(t);let s=e[1];s.parentMessageID="root";let r=new Map;for(let t of e)r.set(t.id,t);for(let t of e){t.parentMessageID||"root"===t.id||(t.parentMessageID=s.id,s=t),t.siblingIndex=-1,t.childMessages=[];let e=r.get(t.parentMessageID);e&&(t.parentMessage=e,null==e.selectedChild&&(e.selectedChild=t),e.childMessages.push(t),t.siblingIndex=e.childMessages.length-1)}let a=e.at(-1);for(;a;){let e=a.parentMessage;e&&(e.selectedChild=a),a=e}}function a(e,t){let s=e.find(e=>e.id===t.parentMessageID);t.siblingIndex=-1,s&&(s.childMessages||(s.childMessages=[]),s.selectedChild=t,t.parentMessage=s,s.childMessages.at(-1)?.id===t.id&&s.childMessages.pop(),s.childMessages.push(t),t.siblingIndex=s.childMessages.length-1)}function i(e){let t=e[0],s=[];for(;t;)if("root"!==t.id&&s.push(t),void 0!==t.selectedChild)t=t.selectedChild;else break;return s}function n(e){e.parentMessage&&(e.parentMessage.selectedChild=e)}function o(e){e.selectedChild&&(e.selectedChild=void 0)}s.d(t,{B:()=>i,HR:()=>a,TC:()=>o,Zh:()=>n,zh:()=>r})},10411:(e,t,s)=>{s.d(t,{W:()=>a});var r=s(6051);let a=new class CopilotFeatureFlags{get embedding(){return(0,r.G7)("copilot_conversational_ux_embedding_update")}get unstickyReferences(){return(0,r.G7)("copilot_conversational_ux_history_refs")}get implicitContext(){return(0,r.G7)("COPILOT_IMPLICIT_CONTEXT")}get customInstructions(){return(0,r.G7)("copilot_chat_custom_instructions")}get personalInstructions(){return(0,r.G7)("copilot_personal_instructions")}get reactMarkdown(){return(0,r.G7)("copilot_react_markdown")}get dotcomUserServerTokens(){return(0,r.G7)("copilot_chat_dotcom_user_server_tokens")}get immersiveFilePreview(){return(0,r.G7)("copilot_immersive_file_preview")}get immersiveIssuePreview(){return(0,r.G7)("copilot_immersive_issue_preview")}get magicKBs(){return(0,r.G7)("copilot_chat_magic_kbs")}get bringYourOwnKey(){return(0,r.G7)("copilot_byok")}get newReferencesUI(){return(0,r.G7)("copilot_new_references_ui")}get repoCustomInstructions(){return(0,r.G7)("copilot_chat_repo_custom_instructions")}get repoCustomInstructionsPreview(){return(0,r.G7)("copilot_chat_repo_custom_instructions_preview")}get copilotFreeLimitedUser(){return(0,r.G7)("copilot_free_limited_user")}get sharedTopicIndicator(){return(0,r.G7)("copilot_chat_shared_topic_indicator")}get sharedSSOBanner(){return(0,r.G7)("copilot_chat_shared_repo_sso_banner")}get copilotChatAttachImages(){return(0,r.G7)("copilot_chat_attach_images")}get copilotChatRetryOnError(){return(0,r.G7)("copilot_chat_retry_on_error")}get immersiveSubthreading(){return(0,r.G7)("copilot_chat_immersive_subthreading")}get copilotChatPersistSubmittedInput(){return(0,r.G7)("copilot_chat_persist_submitted_input")}get customCopilots(){return(0,r.G7)("copilot_custom_copilots")}get bypassIndexingQuota(){return(0,r.G7)("bypass_copilot_indexing_quota")}get reduceTelemetry(){return(0,r.G7)("copilot_dotcom_chat_reduce_telemetry")}get editorUpsells(){return(0,r.G7)("copilot_editor_upsells")}get shareConversation(){return(0,r.G7)("copilot_share_conversation")}get clientDOMSkills(){return(0,r.G7)("copilot_client_dom_skills")}get newMarkdownRenderer(){return(0,r.G7)("copilot_new_markdown_renderer")}get sharedChatInput(){return(0,r.G7)("copilot_chat_shared_chat_input")}get dotcomChatClientSideSkills(){return(0,r.G7)("dotcom_chat_client_side_skills")}get attachFolderReference(){return(0,r.G7)("copilot_attach_folder_reference")}get taskOrientedAssistive(){return(0,r.G7)("copilot_task_oriented_assistive")}}},3004:(e,t,s)=>{s.d(t,{J:()=>n});var r=s(45062),a=s(10943),i=s(38253);let CopilotLocalStorage=class CopilotLocalStorage{get selectedThreadID(){return this.localStorage.getItem(this.COPILOT_SELECTED_THREAD_ID_STORAGE_KEY)}set selectedThreadID(e){let t=this.COPILOT_SELECTED_THREAD_ID_STORAGE_KEY;if(null==e){this.localStorage.removeItem(t);return}this.localStorage.setItem(t,e)}getModel(e){let t=this.localStorage.getItem(this.COPILOT_SELECTED_MODEL_STORAGE_KEY(e));return null===t?t:JSON.parse(t)}setModel(e,t){this.localStorage.setItem(this.COPILOT_SELECTED_MODEL_STORAGE_KEY(e),JSON.stringify(t))}get settings(){let e=this.localStorage.getItem(this.COPILOT_SETTINGS_STORAGE_KEY(this.selectedThreadID));return null===e?e:JSON.parse(e)}set settings(e){this.localStorage.setItem(this.COPILOT_SETTINGS_STORAGE_KEY(this.selectedThreadID),JSON.stringify(e))}getPanelHeight(){let e=this.localStorage.getItem(this.COPILOT_PANEL_HEIGHT);return e?parseInt(e):this.DEFAULT_PANEL_HEIGHT}setPanelHeight(e){let t=this.COPILOT_PANEL_HEIGHT;this.localStorage.setItem(t,e.toString())}getPanelWidth(){let e=this.localStorage.getItem(this.COPILOT_PANEL_WIDTH);return e?parseInt(e):this.DEFAULT_PANEL_WIDTH}setPanelWidth(e){let t=this.COPILOT_PANEL_WIDTH;this.localStorage.setItem(t,e.toString())}getRepoCustomInstructionsState(){return"false"!==this.localStorage.getItem(this.COPILOT_REPO_CUSTOM_INSTRUCTIONS_STATE_KEY)}setRepoCustomInstructionsState(e){let t=this.COPILOT_REPO_CUSTOM_INSTRUCTIONS_STATE_KEY;this.localStorage.setItem(t,e.toString())}getCollapsedState(){return"false"!==this.sessionStorage.getItem(this.COPILOT_COLLAPSED_STATE_KEY)}setCollapsedState(e){let t=this.COPILOT_COLLAPSED_STATE_KEY;this.sessionStorage.setItem(t,e.toString())}getSelectedTopic(e){return this.localStorage.getItem(this.COPILOT_SELECTED_TOPIC_STORAGE_KEY(e))}setSelectedTopic(e,t){if(null==t){this.localStorage.removeItem(this.COPILOT_SELECTED_TOPIC_STORAGE_KEY(e));return}let s=this.COPILOT_SELECTED_TOPIC_STORAGE_KEY(e);this.localStorage.setItem(s,t)}getSavedMessage(e){return this.localStorage.getItem(this.COPILOT_SAVED_USER_MESSAGE_KEY(e))}setSavedMessage(e,t){this.setSavedMessageFast(e,t)}setSavedMessageFast(e,t){let s=this.COPILOT_SAVED_USER_MESSAGE_KEY(e);if(null==t){this.localStorage.removeItem(s);return}this.localStorage.setItem(s,t)}clearSavedUserMessage(e){this.localStorage.removeItem(this.COPILOT_SAVED_USER_MESSAGE_KEY(e))}getSavedUserMessageOnError(e){return this.localStorage.getItem(this.COPILOT_SAVED_USER_MESSAGE_ON_ERROR_KEY(e))}setSavedUserMessageOnError(e,t){let s=this.COPILOT_SAVED_USER_MESSAGE_ON_ERROR_KEY(e);if(null==t){this.localStorage.removeItem(s);return}this.localStorage.setItem(s,t)}clearSavedUserMessageOnError(e){this.localStorage.removeItem(this.COPILOT_SAVED_USER_MESSAGE_ON_ERROR_KEY(e))}getEntrypointMessage(){return this.localStorage.getItem(this.COPILOT_ENTRYPOINT_MESSAGE_KEY)}setEntrypointMessage(e){if(null==e){this.localStorage.removeItem(this.COPILOT_ENTRYPOINT_MESSAGE_KEY);return}this.localStorage.setItem(this.COPILOT_ENTRYPOINT_MESSAGE_KEY,e)}getCurrentReferences(e){let t=this.COPILOT_CURRENT_REFERENCES_KEY(e),s=this.localStorage.getItem(t);return s?JSON.parse(s):null}setCurrentReferences(e,t){let s=this.COPILOT_CURRENT_REFERENCES_KEY(e),r=t.filter((e,s)=>s===t.findIndex(t=>(0,i.Vb)(e)===(0,i.Vb)(t)));this.localStorage.setItem(s,JSON.stringify(r))}clearCurrentReferences(e){let t=this.COPILOT_CURRENT_REFERENCES_KEY(e);this.localStorage.removeItem(t)}migrateNullThreadToNewThread(e){let t=this.getSavedMessage(null);this.setSavedMessageFast(null,null),t&&this.setSavedMessage(e,t);let s=this.getCurrentReferences(null);this.clearCurrentReferences(null),s&&this.setCurrentReferences(e,s)}getImmersiveSidebarCollapsedState(){return"true"===localStorage.getItem(this.COPILOT_IMMERSIVE_SIDEBAR_COLLAPSED_STATE_KEY)}setImmersiveSidebarCollapsedState(e){localStorage.setItem(this.COPILOT_IMMERSIVE_SIDEBAR_COLLAPSED_STATE_KEY,String(e))}getMeterBannerFlag(){let e=this.localStorage.getItem("COPILOT_METER_BANNER_FLAG");return null===e?null:"true"===e}setMeterBannerFlag(e){this.localStorage.setItem("COPILOT_METER_BANNER_FLAG",String(e))}removeMeterBannerFlag(){this.localStorage.removeItem("COPILOT_METER_BANNER_FLAG")}getTrialSuccessBannerFlag(){let e=this.tempStorage.getItem("COPILOT_TRIAL_SUCCESS_BANNER_FLAG");return null===e?null:"true"===e}setTrialSuccessBannerFlag(e){this.tempStorage.setItem("COPILOT_TRIAL_SUCCESS_BANNER_FLAG",String(e))}removeTrialSuccessBannerFlag(){this.tempStorage.removeItem("COPILOT_TRIAL_SUCCESS_BANNER_FLAG")}constructor(){this.COPILOT_REPO_CUSTOM_INSTRUCTIONS_STATE_KEY="COPILOT_REPO_CUSTOM_INSTRUCTIONS_STATE_KEY",this.COPILOT_SELECTED_THREAD_ID_STORAGE_KEY="COPILOT_SELECTED_THREAD_ID_STORAGE_KEY",this.COPILOT_COLLAPSED_STATE_KEY="COPILOT_COLLAPSED_STATE_KEY",this.COPILOT_IMMERSIVE_SIDEBAR_COLLAPSED_STATE_KEY="COPILOT_IMMERSIVE_SIDEBAR_COLLAPSED_STATE_KEY",this.COPILOT_PANEL_HEIGHT="COPILOT_PANEL_HEIGHT",this.DEFAULT_PANEL_HEIGHT=600,this.COPILOT_PANEL_WIDTH="COPILOT_PANEL_WIDTH",this.COPILOT_ENTRYPOINT_MESSAGE_KEY="COPILOT_ENTRYPOINT_MESSAGE_KEY",this.DEFAULT_PANEL_WIDTH=480,this.COPILOT_SELECTED_MODEL_STORAGE_KEY=e=>`COPILOT_SELECTED_MODEL_${e}`,this.COPILOT_SETTINGS_STORAGE_KEY=e=>`COPILOT_SETTINGS_${e}`,this.COPILOT_SAVED_USER_MESSAGE_KEY=e=>`COPILOT_SAVED_USER_MESSAGE_${e}`,this.COPILOT_SAVED_USER_MESSAGE_ON_ERROR_KEY=e=>`COPILOT_SAVED_USER_MESSAGE_ON_ERROR_${e}`,this.COPILOT_CURRENT_REFERENCES_KEY=e=>`COPILOT_CURRENT_REFERENCES_${e}`,this.COPILOT_SELECTED_TOPIC_STORAGE_KEY=e=>`COPILOT_SELECTED_TOPIC_${e}`,this.localStorage=(0,a.A)("localStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5}),this.tempStorage=(0,a.A)("localStorage",{throwQuotaErrorsOnSet:!1,ttl:18e5}),this.sessionStorage=(0,a.A)("sessionStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5})}};!function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);i>3&&n&&Object.defineProperty(t,s,n)}([(0,r.s)(100)],CopilotLocalStorage.prototype,"setSavedMessage",null);let n=new CopilotLocalStorage},24538:(e,t,s)=>{s.d(t,{U:()=>n,e:()=>o});let r=["o1","o1-mini","o1-ga"],a="/images/modules/marketplace/models/families/openai.svg",i=new Map([["Azure OpenAI",a],["Anthropic","/images/modules/marketplace/models/families/anthropic.svg"],["Google","/images/modules/marketplace/models/families/gemini.svg"]]),n={capabilities:{family:"gpt-4o",limits:{max_prompt_tokens:2e4},supports:{parallel_tool_calls:!0,tool_calls:!0},tokenizer:"o200k_base",type:"chat"},id:"gpt-4o",name:"GPT 4o",version:"gpt-4o-2024-05-13",displayName:"GPT 4o",vendor:"Azure OpenAI",logoURL:a,hasLimitedCapabilities:!1,preview:!1,isThirdParty:!1,model_picker_enabled:!0};function o(e){return(e??[n]).map(l).filter(e=>!!e).filter(e=>e.model_picker_enabled)}function l(e){return"chat"===e.capabilities.type&&e.model_picker_enabled&&(!e.policy||"enabled"===e.policy.state||e.policy.terms)?{...e,displayName:function(e){for(let t of c)if(e.name.endsWith(t))return e.name.replace(t,"").trim();return e.name}(e),hasLimitedCapabilities:r.includes(e.capabilities.family),isThirdParty:"Azure OpenAI"!==e.vendor,logoURL:i.get(e.vendor)}:null}let c=["(Beta)","(Preview)"]},91441:(e,t,s)=>{s.d(t,{K:()=>ReadLocalWorkspaceFileSkill});var r=s(10943),a=s(16142),i=s(90254);let ReadLocalWorkspaceFileSkill=class ReadLocalWorkspaceFileSkill{requiresConfirmation(){return!1}confirmationMessage(){return"Read the local workspace file"}static schema(){return{type:"function",function:{name:"read-local-workspace-file",description:"Read a local file. This can be used to read files on the user's local machine. It is the equivalent of running `cat` in the terminal. The file path is relative to the current directory.",parameters:{type:"object",required:["path","repository","pullRequest"],properties:{path:{type:"string",description:"The path to the file to read."},repository:{required:["ownerLogin","name"],type:"object",description:"the repository containing the file to read.",properties:{ownerLogin:{type:"string",description:"the owner of the repository."},name:{type:"string",description:"the name of the repository."}}},pullRequest:{type:"object",description:"the pull request containing the file to read.",required:["number","headSHA"],properties:{number:{type:"string",description:"the number of the pull request."},headSHA:{type:"string",description:"the head SHA of the pull request."}}}}}}}}assertDefined(e,t){if(null==e)throw Error(t)}validateArgs(){let e=JSON.parse(this.rawArguments);return this.assertDefined(e,"No parsed arguments found in raw arguments"),this.assertDefined(e.path,"No path found on parsed arguments"),this.assertDefined(e.repository,"No repository found on parsed arguments"),this.assertDefined(e.pullRequest,"No pullRequest found on parsed arguments"),this.assertDefined(e.repository.ownerLogin,"No ownerLogin found on repository"),this.assertDefined(e.repository.name,"No name found on repository"),this.assertDefined(e.pullRequest.number,"No number found on pullRequest"),this.assertDefined(e.pullRequest.headSHA,"No headSHA found on pullRequest"),e}getArguments(){let e=this.validateArgs(),{repository:t,pullRequest:s}=e;return{path:e.path.startsWith("./")?e.path.slice(2):e.path,repository:t,pullRequest:s}}async fetchBlob(e,t,s){try{let r=await this.blobService.getBlob(e,t.ownerLogin,s.number,t.name,s.headSHA);return r.ok&&r.payload.blobContents||""}catch{return""}}async execute(){try{let e=(0,r.A)("localStorage"),{path:t,repository:s,pullRequest:a}=this.getArguments(),n=await this.fetchBlob(t,s,a),o=`hadron-editor-file-deltas-v2/${s.ownerLogin}/${s.name}/${a.number}`,l=JSON.parse(e.getItem(o)||"{}"),c=(l||{diffs:[],sessionId:"",latestTimestamp:0}).diffs?.find(e=>e.path===t);if(!c)return{name:this.name,arguments:this.rawArguments,result:n};let d=(0,i.X6)(n??"",c.diff),u=!1===d?n:d;return{name:this.name,arguments:this.rawArguments,result:u}}catch(e){return{name:this.name,arguments:this.rawArguments,result:`Error: ${e instanceof Error?e.message:`Error executing ${this.name} skill`}`}}}constructor(e,t,s){this.id=e,this.name=t,this.rawArguments=s,this.blobService=new a.T}}},72376:(e,t,s)=>{s.d(t,{G:()=>n,W:()=>i});var r=s(84569),a=s(10411);function i(e){return!!e&&e!==r.mF.Unlicensed&&a.W.taskOrientedAssistive}function n(e,t){if(!i(t))return!1;let s=e.context?.[0]??e.currentTopic;return!!s&&"pull-request"===("type"in s&&"string"==typeof s.type?s.type:"repository")}},98063:(e,t,s)=>{let r;s.d(t,{BI:()=>p,Ti:()=>g,lA:()=>h});var a=s(70837),i=s(18679),n=s(10943),o=s(29583);let{getItem:l}=(0,n.A)("localStorage"),c="dimension_",d=["utm_source","utm_medium","utm_campaign","utm_term","utm_content","scid"];try{let e=(0,a.O)("octolytics");delete e.baseContext,r=new i.s(e)}catch{}function u(e){let t=(0,a.O)("octolytics").baseContext||{};if(t)for(let[e,s]of(delete t.app_id,delete t.event_url,delete t.host,Object.entries(t)))e.startsWith(c)&&(t[e.replace(c,"")]=s,delete t[e]);let s=document.querySelector("meta[name=visitor-payload]");for(let[e,r]of(s&&Object.assign(t,JSON.parse(atob(s.content))),new URLSearchParams(window.location.search)))d.includes(e.toLowerCase())&&(t[e]=r);return t.staff=(0,o.X)().toString(),Object.assign(t,e)}function h(e){r?.sendPageView(u(e))}function p(e,t={}){let s=document.head?.querySelector('meta[name="current-catalog-service"]')?.content,a=s?{service:s}:{};for(let[e,s]of Object.entries(t))null!=s&&(a[e]=`${s}`);r&&(u(a),r.sendEvent(e||"unknown",u(a)))}function g(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,JSON.stringify(t)]))}},73467:(e,t,s)=>{s.d(t,{J:()=>r});function r(e){let t=e.indexOf("/");if(-1===t||0===t)return`${e} in:name archived:false`;let s=e.slice(0,t),r=e.slice(t+1);return 0===r.length?`org:${s} in:name archived:false`:`org:${s} ${r} in:name archived:false`}},21503:(e,t,s)=>{function r(e,t,s){if(!t.has(e))throw TypeError("attempted to "+s+" private field on non-instance");return t.get(e)}function a(e,t){var s=r(e,t,"get");return s.get?s.get.call(e):s.value}function i(e,t,s){!function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,s)}function n(e,t,s){var a=r(e,t,"set");return!function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=s}}(e,a,s),s}s.d(t,{Es:()=>ObservableMap,Lj:()=>ObservableValue,yy:()=>ObservableSet});var o=new WeakMap;let l=class ObservableBase{subscribe(e){return a(this,o).add(e),()=>{a(this,o).delete(e)}}notify(e){for(let t of a(this,o))t(e)}constructor(){i(this,o,{writable:!0,value:void 0}),n(this,o,new Set)}};var c=new WeakMap;let ObservableValue=class ObservableValue extends l{get value(){return a(this,c)}set value(e){var t;t=a(this,c),("object"==typeof e&&e&&"object"==typeof t&&t?function(e,t){for(let s of new Set(Object.keys(e).concat(Object.keys(t))))if(!Object.is(e[s],t[s]))return!0;return!1}(t,e):!Object.is(t,e))&&(n(this,c,e),this.notify(e))}constructor(e){super(),i(this,c,{writable:!0,value:void 0}),n(this,c,e)}};var d=new WeakMap,u=new WeakMap;let ObservableSet=class ObservableSet extends l{get value(){return a(this,d)}has(e){if(!a(this,u).has(e)){let t=new ObservableValue(a(this,d).has(e));a(this,u).set(e,t)}return a(this,u).get(e)}add(e){a(this,d).has(e)||(a(this,d).add(e),a(this,u).has(e)&&(a(this,u).get(e).value=!0),this.notify(a(this,d)))}delete(e){a(this,d).has(e)&&(a(this,d).delete(e),a(this,u).has(e)&&(a(this,u).get(e).value=!1),this.notify(a(this,d)))}clear(){if(0!==a(this,d).size){for(let e of(a(this,d).clear(),a(this,u).values()))e.value=!1;this.notify(a(this,d))}}constructor(...e){super(),i(this,d,{writable:!0,value:void 0}),i(this,u,{writable:!0,value:void 0}),n(this,u,new Map),n(this,d,new Set(...e))}};var h=new WeakMap,p=new WeakMap,g=new WeakMap;let ObservableMap=class ObservableMap extends l{get value(){return a(this,h)}has(e){if(!a(this,p).has(e)){let t=new ObservableValue(a(this,h).has(e));a(this,p).set(e,t)}return a(this,p).get(e)}get(e){if(!a(this,g).has(e)){let t=new ObservableValue(a(this,h).get(e));a(this,g).set(e,t)}return a(this,g).get(e)}set(e,t){a(this,h).get(e)!==t&&(a(this,h).set(e,t),a(this,p).has(e)&&(a(this,p).get(e).value=!0),a(this,g).has(e)&&(a(this,g).get(e).value=t),this.notify(a(this,h)))}delete(e){a(this,h).has(e)&&(a(this,h).delete(e),a(this,p).has(e)&&(a(this,p).get(e).value=!1),a(this,g).has(e)&&(a(this,g).get(e).value=void 0),this.notify(a(this,h)))}clear(){if(0!==a(this,h).size){for(let e of(a(this,h).clear(),a(this,p).values()))e.value=!1;for(let e of a(this,g).values())e.value=void 0;this.notify(a(this,h))}}constructor(...e){super(),i(this,h,{writable:!0,value:void 0}),i(this,p,{writable:!0,value:void 0}),i(this,g,{writable:!0,value:void 0}),n(this,p,new Map),n(this,g,new Map),n(this,h,new Map(...e))}}},81299:(e,t,s)=>{s.d(t,{AI:()=>i,HN:()=>l,R:()=>n,Rs:()=>o,Sk:()=>d,tQ:()=>c});var r=s(96540),a=s(21503);function i(e){let[t]=(0,r.useState)(()=>new a.Lj(e));return t}function n(...e){let[t]=(0,r.useState)(()=>new a.Es(...e));return t}function o(e,t){let s=(0,r.useRef)(t);(0,r.useEffect)(()=>{s.current=t}),(0,r.useEffect)(()=>e.subscribe(e=>s.current(e)),[e])}function l(e){let[t,s]=(0,r.useState)(e.value);return o(e,e=>s(e)),t}function c(e){let[t,s]=(0,r.useState)(e.value),[a,i]=(0,r.useState)({});return o(e,e=>{s(e),i({})}),t}function d(e,t){let s=i(t(e.value));return o(e,e=>{s.value=t(e)}),s}},7025:(e,t,s)=>{s.d(t,{$:()=>u,x:()=>h});var r=s(74848),a=s(97665),i=s(97286),n=s(46335),o=s(96540),l=s(84569),c=s(10411);let CopilotChatEntitlement=class CopilotChatEntitlement{isLicensed(){return this.licenseType&&this.licenseType!==l.mF.Unlicensed}chatQuotaRemaining(){return this.quotas?.remaining.chat??0}constructor(e,t){this.licenseType=e,this.quotas=t}};let d=(0,o.createContext)(void 0);function u({children:e,initialLicenseType:t,initialQuotas:s}){let[u,h]=function(e,t){let s=(0,a.jE)(),r=(0,o.useCallback)(()=>s.invalidateQueries({queryKey:["copilot-chat","entitlement"]}),[s]),{data:d}=(0,i.I)({queryKey:["copilot-chat","entitlement"],queryFn:async()=>{let e=await (0,n.lS)("/github-copilot/chat/entitlement");if(!e.ok)throw Error(`Failed to retrieve Copilot chat entitlement (${e.status} on ${e.url})`);return await e.json()},enabled:c.W.copilotFreeLimitedUser&&e===l.mF.LicensedLimited,placeholderData:{licenseType:e,quotas:t},staleTime:3e5}),u=d?.licenseType??e,h=(0,o.useCallback)(()=>{c.W.copilotFreeLimitedUser&&u===l.mF.LicensedLimited&&r()},[r,u]);return[new CopilotChatEntitlement(u,d?.quotas),h]}(t,s),p=u.licenseType,g=c.W.copilotFreeLimitedUser?u.chatQuotaRemaining()??1/0:1/0,m=c.W.copilotFreeLimitedUser&&u.quotas?.resetDate?new Date(u.quotas.resetDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"",E=!!c.W.copilotFreeLimitedUser&&p===l.mF.LicensedLimited,_=!!c.W.copilotFreeLimitedUser&&E&&g<=0,f=(0,o.useMemo)(()=>({licenseType:p,chatQuotaRemaining:g,resetDate:m,isLicensedLimited:E,chatQuotaExceeded:_,reloadQuota:h}),[p,g,m,E,_,h]);return(0,r.jsx)(d.Provider,{value:f,children:e})}let h=()=>{let e=(0,o.useContext)(d);if(!e)throw Error("useEntitlement must be used within EntitlementProvider");return e};try{d.displayName||(d.displayName="EntitlementContext")}catch{}try{u.displayName||(u.displayName="EntitlementProvider")}catch{}},70368:(e,t,s)=>{s.d(t,{A:()=>c,c:()=>d});var r=s(74848),a=s(96540),i=s(38253),n=s(10411);let CopilotAutocompleteManager=class CopilotAutocompleteManager{async fetchAutocompleteSuggestions(e,t){let[s,r]=await Promise.all([this.manager.service.querySymbols(e,t),this.manager.service.listRepoFiles(e,n.W.attachFolderReference)]);if(s.ok){let t=s.payload.flatMap(t=>t.symbol?[(0,i.Qt)(t,e)]:[]);this.symbolSuggestions=new Map(t.map(e=>[e.name,e]))}if(this.repoSuggestionsCache.has(e.name)){[this.fileSuggestions,this.folderSuggestions]=this.repoSuggestionsCache.get(e.name);return}if(r.ok){let t=new Map,s=new Map;this.repoSuggestionsCache.set(e.name,[t,s]);let a=0,n=[...(r.payload.paths||[]).map(e=>({type:"path",path:e})),...(r.payload.directories||[]).map(e=>({type:"folder",path:e}))],o=()=>{let r=Math.min(a+5e3,n.length);for(;a<r;a++){let r=n[a];if(r?.type==="path"){let s=(0,i.iW)(r.path,e);t.set(s.path,s)}else if(r?.type==="folder"){let t=(0,i.OC)(r.path,e);s.set(t.path,t)}}if(a<n.length)setTimeout(o,0);else{this.fileSuggestions=t,this.folderSuggestions=s;return}};o()}}async addToReferences(e,t){let s=(0,i.Vb)(e);if(this.findReference(s,t))return;let r=e;if((0,i.SI)(e)){let t=await this.manager.service.fetchLanguageForFileReference(e);if(t.ok&&t.payload.language){let{languageName:s,languageId:a}=t.payload.language;r={...e,languageName:s,languageId:a}}}this.manager.addReference(r,"autocomplete")}findReference(e,t){return t.currentReferences.find(t=>e===(0,i.Vb)(t))}constructor(e){this.fileSuggestions=new Map,this.folderSuggestions=new Map,this.symbolSuggestions=new Map,this.repoSuggestionsCache=new Map,this.manager=e}};var o=s(26973);let l=(0,a.createContext)(null);function c({children:e}){let t=(0,o.b)(),s=(0,a.useMemo)(()=>new CopilotAutocompleteManager(t),[t]);return(0,r.jsx)(l.Provider,{value:s,children:e})}function d(){return(0,a.useContext)(l)}try{l.displayName||(l.displayName="CopilotChatAutocompleteContext")}catch{}try{c.displayName||(c.displayName="CopilotChatAutocompleteProvider")}catch{}},2982:(e,t,s)=>{s.d(t,{Jf:()=>L,Mj:()=>k,IJ:()=>U,qY:()=>B,Pk:()=>b,pn:()=>N,A3:()=>G,bP:()=>x});var r=s(74848),a=s(81299),i=s(58790),n=s(6499),o=s(96540),l=s(18312),c=s(7025);let d=(0,s(10943).A)("sessionStorage");function u(e,t){return!!e&&"assistive"===t}let h="restored-chat-messages";var p=s(38253),g=s(98063),m=s(44036),E=s(10411),_=s(3004);let f=(e,t)=>{let s=t=>{t&&(_.J.selectedThreadID=t);let s=_.J.getModel(t)?.id,r=e.availableModels?.find(e=>e.id===s)??e.model;return{...e,model:r,selectedThreadID:t,currentView:"thread",showTopicPicker:!t&&e.showTopicPicker}},r=t=>(_.J.setCurrentReferences(e.selectedThreadID,t),{...e,currentReferences:t});switch(t.type){case"SLASH_COMMANDS_ERROR":return(0,g.BI)("copilot.slash_commands_error"),{...e,slashCommandLoading:{...e.slashCommandLoading,state:"error"}};case"SLASH_COMMANDS_LOADED":return(0,g.BI)("copilot.slash_commands_loaded"),{...e,slashCommandLoading:{...e.slashCommandLoading,state:"loaded"}};case"SLASH_COMMANDS_LOADING":return E.W.reduceTelemetry||(0,g.BI)("copilot.slash_commands_loading"),{...e,slashCommandLoading:{...e.slashCommandLoading,state:"loading"}};case"OPEN_COPILOT_CHAT":return(0,g.BI)("copilot.open_copilot_chat",{source:t.source}),{...e,chatIsOpen:!0,chatIsVisible:!0,entryPointId:t.id};case"CLOSE_COPILOT_CHAT":return(0,g.BI)("copilot.close_copilot_chat"),{...e,chatIsOpen:!1};case"HIDE_COPILOT_CHAT":return(0,g.BI)("copilot.hide_copilot_chat"),{...e,chatIsVisible:!1};case"THREAD_CREATED":return(0,g.BI)("copilot.thread_created",{...T(t.thread),mode:e.mode,count:e.threads.size+1}),{...s(t.thread.id),threads:new Map(e.threads.set(t.thread.id,t.thread))};case"SUGGESTIONS_GENERATED":return{...e,suggestions:t.suggestions};case"CLEAR_SUGGESTIONS":return{...e,suggestions:null};case"CLEAR_THREAD":return(0,g.BI)("copilot.clear_thread"),{...e,messages:[],currentReferences:[]};case"CLEAR_REFERENCES":return E.W.reduceTelemetry||(0,g.BI)("copilot.clear_references"),{...e,currentReferences:e.currentReferences.filter(e=>"docset"===e.type||"magic-knowledge-base"===e.type)};case"CLEAR_CURRENT_REFERENCES":return(0,g.BI)("copilot.clear_current_references"),{...e,currentReferences:[]};case"MESSAGES_UPDATED":{let s=t.messages?[...t.messages]:[];if("error"!==t.state&&E.W.reduceTelemetry||(0,g.BI)("copilot.messages_updated",{count:t.messages?.length,loading:t.state}),!s)return E.W.immersiveSubthreading&&(0,m.zh)(s),{...e,messagesLoading:{...e.messagesLoading,state:t.state}};{let r=e.defaultRecipient,a=e.allClientConfirmations;return"loaded"===t.state&&s.length>0&&(r=w(s[s.length-1],e),a=s.map(e=>e.clientConfirmations?.map(e=>JSON.stringify(Object.values(e.confirmation).sort()))).flat().filter(Boolean)),E.W.immersiveSubthreading&&(0,m.zh)(s),{...e,defaultRecipient:r,allClientConfirmations:a,messages:s,messagesLoading:{...e.messagesLoading,state:t.state},messagesRestored:!1}}}case"WAITING_ON_COPILOT":return E.W.reduceTelemetry||(0,g.BI)("copilot.waiting_on_copilot",{isWaitingOnCopilot:t.loading}),{...e,isWaitingOnCopilot:t.loading};case"SELECT_THREAD":return(0,g.BI)("copilot.select_thread",{threadID:t.thread?.id,mode:e.mode}),{...s(t.thread?.id||null),currentTopic:t.clearTopic?void 0:e.currentTopic,topicLoading:t.clearTopic?{error:null,state:"loaded"}:e.topicLoading};case"HANDLE_EVENT_START":return(0,g.BI)("copilot.handle_event_start"),{...t.references?r(t.references):e,chatIsOpen:!0,chatIsVisible:!0,entryPointId:t.id};case"THREADS_LOADING":return E.W.reduceTelemetry||(0,g.BI)("copilot.threads_loading"),{...e,threadsLoading:{...e.threadsLoading,state:"loading"}};case"DISMISS_ATTACH_KNOWLEDGE_BASE_HERE_POPOVER":return(0,g.BI)("copilot.dismiss_attach_knowledge_base_here_popover"),{...e,renderAttachKnowledgeBaseHerePopover:!1};case"DISMISS_KNOWLEDGE_BASE_ATTACHED_TO_CHAT_POPOVER":return(0,g.BI)("copilot.dismiss_knowledge_base_attached_to_chat_popover"),{...e,renderKnowledgeBaseAttachedToChatPopover:!1};case"KNOWLEDGE_BASES_LOADING":return E.W.reduceTelemetry||(0,g.BI)("copilot.knowledge_bases_loading"),{...e,knowledgeBasesLoading:{...e.knowledgeBasesLoading,state:"loading"}};case"KNOWLEDGE_BASES_LOADED":return(0,g.BI)("copilot.knowledge_bases_loaded",{count:t.knowledgeBases.length}),{...e,knowledgeBases:t.knowledgeBases,knowledgeBasesLoading:{...e.knowledgeBasesLoading,state:"loaded",error:null}};case"KNOWLEDGE_BASES_LOADING_ERROR":return(0,g.BI)("copilot.knowledge_bases_loading_error",{error:t.message}),{...e,knowledgeBasesLoading:{...e.knowledgeBasesLoading,state:"error",error:t.message}};case"LATEST_THREAD_LOADED":return{...e,threads:new Map(e.threads.set(t.latestThread.id,t.latestThread))};case"THREADS_LOADED":return(0,g.BI)("copilot.threads_loaded",{count:t.threads.length,mode:e.mode}),{...e,threadsLoading:{...e.threadsLoading,state:"loaded"},threads:new Map(t.threads.map(e=>[e.id,e]))};case"THREADS_LOADING_ERROR":return(0,g.BI)("copilot.threads_loading_error",{error:t.message}),{...e,threadsLoading:{error:t.message,state:"error"}};case"DELETE_THREAD_KEEP_SELECTION":return(0,g.BI)("copilot.thread_deleted",{...T(t.thread),count:e.threads.size-1}),e.threads.delete(t.thread.id),{...s(null),threads:new Map(e.threads),threadsLoading:{...e.threadsLoading,state:"loaded"},messages:[],messagesLoading:{state:"loaded",error:null},currentReferences:[],currentView:"list"};case"DELETE_ALL_THREADS_KEEP_SELECTION":for(let s of t.threads)(0,g.BI)("copilot.thread_deleted",{...T(s),count:e.threads.size-1}),e.threads.delete(s.id);return{...s(null),threads:new Map(e.threads),threadsLoading:{...e.threadsLoading,state:"loaded"},messages:[],messagesLoading:{state:"loaded",error:null},currentReferences:[],currentView:"list"};case"DELETE_THREAD":if((0,g.BI)("copilot.thread_deleted",{...T(t.thread),count:e.threads.size-1,mode:e.mode}),e.threads.delete(t.thread.id),e.selectedThreadID===t.thread.id)return{...s(null),threads:new Map(e.threads),threadsLoading:{...e.threadsLoading,state:"loaded"},messages:[],messagesLoading:{state:"loaded",error:null},currentReferences:[]};return{...e,threads:new Map(e.threads)};case"DELETE_THREAD_ERROR":return(0,g.BI)("copilot.delete_thread_error",{...T(t.thread),error:t.error}),{...e,threadsLoading:{...e.threadsLoading,error:t.error},threads:new Map(e.threads.set(t.thread.id,t.thread))};case"DELETE_ALL_THREADS_ERROR":{for(let e of t.threads)(0,g.BI)("copilot.delete_thread_error",{...T(e),error:t.error});let s=new Map(e.threads);for(let e of t.threads)s.set(e.id,e);return{...e,threadsLoading:{...e.threadsLoading,error:t.error},threads:s}}case"MESSAGE_ADDED":{(0,g.BI)("copilot.message_added",{...S(t.message),count:e.messages.length+1,repoHasCustomInstructions:!!t.repoHasCustomInstructions,usedRepoCustomInstructions:!!t.usedRepoCustomInstructions});let s=[...e.messages,t.message];return E.W.immersiveSubthreading&&(0,m.HR)(s,t.message),{...e,messages:s}}case"MESSAGES_SET_SELECTED_MESSAGE":{(0,m.Zh)(t.message);let s=[...e.messages];return{...e,messages:s}}case"MESSAGES_UNSELECT_PREVIOUS_MESSAGE":{(0,m.TC)(t.message);let s=[...e.messages];return{...e,messages:s}}case"THREAD_UPDATED":return E.W.reduceTelemetry||(0,g.BI)("copilot.thread_updated",T(t.thread)),{...e,...s(t.thread.id),threads:new Map(e.threads.set(t.thread.id,t.thread))};case"REFERENCES_LOADED":return(0,g.BI)("copilot.references_loaded",{count:t.references.length}),{...e,currentReferences:t.references};case"ADD_REFERENCE":return(0,g.BI)("copilot.add_reference",{...C(t.reference),source:t.source,count:e.currentReferences.length+1}),{...e,...r([...e.currentReferences.filter(e=>!(0,p.x_)(e,t.reference)),t.reference])};case"REMOVE_REFERENCES":{let s=t.referenceIndexes.map(t=>e.currentReferences[t]).filter(e=>!!e);return s.length>0&&(0,g.BI)("copilot.remove_reference",{types:s.filter((e,s)=>t.referenceIndexes.includes(s)).map(e=>e.type).join(","),count:e.currentReferences.length-s.length}),{...r(e.currentReferences.filter((e,s)=>!t.referenceIndexes.includes(s)))}}case"SHOW_TOPIC_PICKER":return{...e,showTopicPicker:t.show};case"CURRENT_TOPIC_UPDATED":return t.topic&&(0,g.BI)("copilot.current_topic_updated",{type:t.topic?(0,p.P)(t.topic)?"docset":"repository":"none",mode:e.mode}),{...e,currentTopic:t.topic,topicLoading:{...e.topicLoading,state:t.state}};case"MESSAGE_STREAMING_STARTED":return E.W.reduceTelemetry||(0,g.BI)("copilot.message_streaming_started",{...S(t.message),count:e.messages.length}),{...e,isWaitingOnCopilot:!0,streamingMessage:t.message,messages:[...e.messages]};case"MESSAGE_STREAMING_TOKEN_ADDED":return{...e,streamingMessage:e.streamingMessage?{...e.streamingMessage,content:e.streamingMessage.content+t.token}:null};case"MESSAGE_STREAMING_FUNCTION_CALLED":if(e.streamingMessage){let s=e.streamingMessage.skillExecutions||[],r=s.findIndex(e=>"started"===e.status),a=r>=0?s[r]:null,i=s;switch(t.status){case"started":i=[...s,{slug:t.name,status:t.status,arguments:t.arguments,errorMessage:t.errorMessage,references:[]}];break;case"completed":a&&(i[r]={...a,status:t.status,references:t.references});break;case"error":a&&(i[r]={...a,status:t.status,errorMessage:t.errorMessage})}return{...e,streamingMessage:{...e.streamingMessage,skillExecutions:i}}}return e;case"READ_DOM_SKILL_INVOKED":return{...e,elementMap:t.elementMap};case"MESSAGE_STREAMING_COMPLETED":{let s,r=e.defaultRecipient,a=e.messages;if(e.streamingMessage&&(r=w(s={...e.streamingMessage,id:t.messageResponse.id,references:t.messageResponse.references,createdAt:t.messageResponse.createdAt,intent:t.messageResponse.intent,copilotAnnotations:t.messageResponse.copilotAnnotations,parentMessageID:t.messageResponse.parentMessageID},e),(0,g.BI)("copilot.message_streaming_completed",{...S(s),...y(t.timings),model:e.model?.id,mode:e.mode,count:e.messages.length+1}),a=[...e.messages,s],E.W.immersiveSubthreading)){if(null==a.find(e=>e.id===s?.parentMessageID)){let e=a.findLast(e=>"user"===e.role);null!=e&&(e.id=s.parentMessageID)}(0,m.HR)(a,s)}return{...e,defaultRecipient:r,isWaitingOnCopilot:!1,streamingMessage:null,messages:a}}case"MESSAGE_STREAMING_FAILED":return(0,g.BI)("copilot.message_streaming_failed",{...e.streamingMessage?S(e.streamingMessage):{},...y(t.timings),model:e.model?.id,mode:e.mode}),{...e,isWaitingOnCopilot:!1,streamingMessage:null};case"MESSAGE_STREAMING_STOPPED":{let s;return e.streamingMessage?(s={...e.streamingMessage,interrupted:!0},(0,g.BI)("copilot.message_streaming_stopped",{...S(s),...y(t.timings),model:e.model?.id,mode:e.mode,count:e.messages.length+1})):e.isWaitingOnCopilot&&(s={id:crypto.randomUUID(),role:"assistant",threadID:e.selectedThreadID??"",references:[],createdAt:new Date().toISOString(),interrupted:!0}),{...e,isWaitingOnCopilot:!1,streamingMessage:null,messages:s?[...e.messages,s]:e.messages}}case"MESSAGES_CLEAR_LAST_ERROR":{let t=e.messages[e.messages.length-1],s=t?.error||t?.interrupted?e.messages.slice(0,-1):e.messages;return{...e,streamingMessage:null,messages:s}}case"SELECT_REFERENCE":return t.reference&&(0,g.BI)("copilot.select_reference",C(t.reference)),{...e,selectedReference:t.reference};case"MODELS_LOADING":return{...e,modelsLoading:{state:"loaded",error:null}};case"MODELS_LOADING_ERROR":return{...e,modelsLoading:{state:"error",error:t.error}};case"MODELS_LOADED":return{...e,availableModels:t.models};case"SELECT_MODEL":if("immersive"!==e.mode)return e;return(0,g.BI)("copilot.select_model",{model:t.model?.name,mode:e.mode}),{...e,model:t.model};case"VIEW_ALL_THREADS":return{...e,currentView:"list"};case"VIEW_CURRENT_THREAD":return{...e,currentView:"thread"};case"IMPLICIT_CONTEXT_UPDATED":if(!(0,p.yR)(t.context,e.context))return{...e,context:t.context};return e;case"SET_TOP_REPOSITORIES":return{...e,topRepositoriesCache:t.topics};case"SET_AGENTS":return{...e,agents:t.agents};case"SET_CUSTOM_COPILOTS":return{...e,customCopilots:t.customCopilots};case"SET_CUSTOM_COPILOT_ID":return{...e,customCopilotId:t.customCopilotId};case"MESSAGE_STREAMING_CONFIRMATION":{let s={title:t.title,message:t.message,confirmation:t.confirmation};return{...e,streamingMessage:e.streamingMessage?{...e.streamingMessage,confirmations:e.streamingMessage.confirmations?[...e.streamingMessage.confirmations,s]:[s]}:null}}case"AGENT_ERROR":{let s=e.streamingMessage,r=t.error;return{...e,streamingMessage:s&&{...s,agentErrors:[...s.agentErrors??[],{type:r.type,code:r.code,message:r.message,identifier:r.identifier}]}}}case"ENTITLEMENT_UPDATED":return{...e,entitlement:t.entitlement??e.entitlement};case"TOGGLE_REPO_CUSTOM_INSTRUCTIONS":return(0,g.BI)("copilot.repo_custom_instructions_toggled",{isEnabling:!!t.value}),{...e,repoCustomInstructionsEnabled:t.value};case"DISMISS_EDITOR_UPSELL_BANNER":return{...e,isEditorUpsellBannerDismissed:!0};case"SET_PERSONAL_INSTRUCTIONS":return{...e,personalInstructions:t.personalInstructions}}};function S(e){var t;if(!e)return(0,g.Ti)({});let s={id:e.id,role:e.role,createdAt:e.createdAt,threadID:e.threadID,referenceCount:e.references?.length??0};return e.intent&&(s.intent=e.intent),e.error&&(s.error=e.error),e.copilotAnnotations&&(s.copilotAnnotations=function(e){if(e)return{CodeVulnerability:e.CodeVulnerability?.map(e=>({details:{type:e?.details?.type}})),PublicCodeReference:e.PublicCodeReference?.map(e=>({details:{license:e?.details?.license,language:e?.details?.language}}))}}(e.copilotAnnotations)),e.skillExecutions&&(s.skillExecutions=(t=e.skillExecutions)?t.map(e=>({slug:e?.slug,status:e?.status,argumentCount:e?.arguments?.length??0,errorMessage:e?.errorMessage,references:e?.references?.length??0})):[]),e.interrupted&&(s.interrupted=!0),(0,g.Ti)(s)}function T(e){return e?(0,g.Ti)({id:e.id,createdAt:e.createdAt,updatedAt:e.updatedAt,currentReferenceCount:e.currentReferences?.length??0}):(0,g.Ti)({})}function C(e){return e?(0,g.Ti)({type:e.type}):(0,g.Ti)({})}function y(e){let t={totalTime:e.endTime-e.startTime};return void 0!==e.firstByte&&(t.ttfb=e.firstByte-e.startTime),void 0!==e.firstToken&&(t.ttft=e.firstToken-e.startTime),t}function w(e,t){let s=(0,p.Th)(e,t.currentUserLogin);if("agent"===s.type)return s.name}var I=s(70368),R=s(26973),O=s(24538),A=s(64003);let D=(0,i.E7)(),L=(0,o.createContext)(null),v=(0,o.createContext)(null);function k({children:e,topic:t,workerPath:s,threadId:a,refs:i,selectedReference:n,mode:g,ssoOrganizations:E,chatIsOpen:S,chatIsVisible:T,chatVisibleSettingPath:C,agents:y,customCopilots:w,messages:A,testReducerState:L,realIp:k,currentView:M,copilotUpsellBannerDismissed:b,copilotChatPayload:N}){let{restoredMessages:G,restoredThreadTitle:x}=function(e,t){let s=u(e,t),r=d.getItem(h),a=r?JSON.parse(r):void 0;return((0,o.useEffect)(()=>{d.removeItem(h)},[]),s&&a?.expiry&&a.expiry>Date.now()&&a.threadId===e)?{restoredMessages:a.restoredMessages,restoredThreadTitle:a.threadTitle}:{}}(a,g);G&&(0,m.zh)(G);let U=L||{threadsLoading:{state:"pending",error:null},messagesLoading:{state:"pending",error:null},messagesRestored:!!G,slashCommandLoading:{state:"pending",error:null},showTopicPicker:"immersive"!==g&&(!a||"assistive"===g)&&!t,topicLoading:{state:"pending",error:null},threads:new Map,restoredThreadTitle:x,knowledgeBasesLoading:{state:"pending",error:null},knowledgeBases:[],model:O.U,availableModels:[O.U],modelsLoading:{state:"pending",error:null},messages:A??G??[],streamer:null,streamingMessage:null,selectedThreadID:a,currentTopic:t,chatIsOpen:!!S,isWaitingOnCopilot:!1,currentUserLogin:N.currentUserLogin,apiUrl:N.apiURL,currentReferences:i,findFileWorkerPath:s,currentView:M||"thread",selectedReference:n??null,mode:g,currentRepository:(0,p.Z6)(t)?t:void 0,ssoOrganizations:E,context:void 0,renderKnowledgeBases:N.renderKnowledgeBases??!0,renderAttachKnowledgeBaseHerePopover:N.renderAttachKnowledgeBaseHerePopover,renderKnowledgeBaseAttachedToChatPopover:N.renderKnowledgeBaseAttachedToChatPopover,customInstructions:N.customInstructions,chatIsVisible:T,chatVisibleSettingPath:C,renderBetaLabel:N.renderBetaLabel,topRepositoriesCache:void 0,agentsPath:N.agentsPath,optedInToPreviewFeatures:N.optedInToPreviewFeatures,optedInToUserFeedback:N.optedInToUserFeedback,agents:y,customCopilots:w,customCopilotId:void 0,suggestionsDismissed:!1,reviewLab:N.reviewLab,repoCustomInstructionsEnabled:_.J.getRepoCustomInstructionsState(),isEditorUpsellBannerDismissed:b,personalInstructions:N.personalInstructions??null},[B,q]=(0,o.useReducer)(f,U);return!function(e,t,s,r){let a=u(t,r);(0,o.useEffect)(()=>{if(!a)return;let r=(e,t)=>{if("childMessages"!==e&&"parentMessage"!==e&&"selectedChild"!==e)return t},i=()=>{if(!e?.length||!t)return;let a=s.get(t),i=a?.name,n={expiry:Date.now()+8e3,restoredMessages:e,threadId:t,threadTitle:i};d.setItem(h,JSON.stringify(n,r))};return window.addEventListener("turbo:before-fetch-response",i),window.addEventListener("beforeunload",i),window.addEventListener("popstate",i),()=>{window.removeEventListener("turbo:before-fetch-response",i),window.removeEventListener("beforeunload",i),window.removeEventListener("popstate",i)}},[e,a,t,s])}(B.messages,B.selectedThreadID,B.threads,B.mode),(0,r.jsx)(c.$,{initialLicenseType:N.licenseType,initialQuotas:N.quotas,children:(0,r.jsx)(P,{state:B,children:(0,r.jsx)(v.Provider,{value:q,children:(0,r.jsx)(R.v,{apiURL:N.apiURL,state:B,dispatch:q,ssoOrganizations:E,realIp:k,hasCEorCBAccess:N.hasCEorCBAccess,children:(0,r.jsx)(I.A,{children:(0,r.jsx)(l.RelayEnvironmentProvider,{environment:D,children:e})})})})})})}let M=(0,o.createContext)(null);function P({state:e,children:t}){let s=(0,a.AI)(e);return(0,n.N)(()=>{s.value=e},[e,s]),(0,r.jsx)(A.sw,{value:s,children:(0,r.jsx)(M.Provider,{value:e,children:t})})}function b(){let e=(0,o.useContext)(M);if(!e)throw Error("useChatState can only be used inside a CopilotChatProvider");return e}function N(e){let t=(0,A.rE)();if(!t)throw Error("useChatStateLens can only be used inside a CopilotChatProvider");let s=(0,a.Sk)(t,e);return(0,a.HN)(s)}function G(e){return N(t=>t[e])}function x(...e){return N(t=>(function(e,t){let s={};for(let r of t)s[r]=e[r];return s})(t,e))}function U(){let e=(0,o.useContext)(v);if(!e)throw Error("useChatDispatch can only be used inside a CopilotChatProvider");return e}function B(){return(0,o.useContext)(L)}try{L.displayName||(L.displayName="ChatPanelReferenceContext")}catch{}try{v.displayName||(v.displayName="CopilotChatDispatchContext")}catch{}try{k.displayName||(k.displayName="CopilotChatProvider")}catch{}try{M.displayName||(M.displayName="ChatStateContext")}catch{}try{P.displayName||(P.displayName="ChatStateProvider")}catch{}},26973:(e,t,s)=>{s.d(t,{b:()=>g,v:()=>p});var r=s(74848),a=s(70170),i=s(96540),n=s(7025),o=s(31142),l=s(10411),c=s(3004),d=s(64003),u=s(72376);let h=(0,i.createContext)(null);function p({apiURL:e,state:t,dispatch:s,ssoOrganizations:p,children:g,realIp:m,hasCEorCBAccess:E}){let _=(0,d.tD)(),f=(0,i.useMemo)(()=>new o.e8(s,e,p,_,m,void 0,E),[s,e,p,_,m,E]),{licenseType:S}=(0,n.x)();return(0,i.useEffect)(()=>{t.chatIsOpen&&(async()=>{if(t.selectedThreadID&&t.messages.length>0&&!t.currentTopic){let e=c.J.getSelectedTopic(t.selectedThreadID),s=Number(e);e&&!isNaN(s)?await f.fetchCurrentRepo(s):f.clearCurrentTopic()}})()},[t.selectedThreadID,f,t.messages.length,t.currentTopic,t.chatIsOpen]),(0,i.useEffect)(()=>{let e=async()=>{let e=window.location.hash,t=window.location.pathname,s=window.location.hash?`${t}${e}`:t,r=s.slice(1).split("/");if(r.length<2)return;let a=r[0],i=r[1];a&&i&&await f.fetchImplicitContext(s,a,i)},s=(0,a.s)(()=>{e()},500);(l.W.implicitContext&&t.chatIsOpen||(0,u.W)(S))&&(s(),function(){let{replaceState:e}=window.history;window.history.replaceState=function(...t){e.apply(window.history,t),window.dispatchEvent(new Event("replaceState"))},window.addEventListener("popstate",s),window.addEventListener("replaceState",s),()=>{window.removeEventListener("popstate",s),window.removeEventListener("replaceState",s)}}())},[f,t.chatIsOpen,S]),(0,r.jsx)(h.Provider,{value:f,children:g})}function g(){let e=(0,i.useContext)(h);if(!e)throw Error("useChatManager must be used within a CopilotChatManagerProvider");return e}try{h.displayName||(h.displayName="CopilotChatManagerContext")}catch{}try{p.displayName||(p.displayName="CopilotChatManagerProvider")}catch{}},64003:(e,t,s)=>{s.d(t,{rE:()=>o,sw:()=>i,tD:()=>n});var r=s(96540);let a=(0,r.createContext)(null),i=a.Provider;function n(){let e=(0,r.useContext)(a);if(!e)throw Error("useGetChatState can only be used inside a CopilotChatProvider");return(0,r.useCallback)(()=>e.value,[e])}function o(){return(0,r.useContext)(a)}try{a.displayName||(a.displayName="ObservableChatStateContext")}catch{}},31142:(e,t,s)=>{s.d(t,{e8:()=>CopilotChatManager,SL:()=>f,AG:()=>S});var r,a=s(74848),i=s(51315),n=s(98063),o=s(46335);let InteractDomSkill=class InteractDomSkill{requiresConfirmation(){return"click"===JSON.parse(this.rawArguments).action}confirmationMessage(){let e=JSON.parse(this.rawArguments),t="";switch(e.action){case"click":t=`Click on ${e.element}`;break;case"type":t=`Type "${e.value}" into ${e.element}`}return t}static schema(){return{type:"function",function:{name:"interact-dom",description:"Perform an action like clicking on an element, typing into an input, or filling out a form on the current html page. Call this skill to fulfill the user request after receiving the current url and tag map of accessible element names to their tags from invoking the read-dom skill. For the type action, if there is existing text in the elemt (passed in the tag map), you should modify that text how the user requests and return the new text contents. Do no just return the new text the user asked you to type unless they are explicitly trying to overwrite the current value. Afterwards, you should send a message letting the user know the actions you performed.",parameters:{type:"object",required:["action, element"],properties:{action:{type:"string",description:'The DOM action to take on an element on the current page. The action property can either be "click" or "type". If it is "type" then the value property should be the string to type into the input element.'},element:{type:"string",description:"The accessible name of the element to perform the DOM action on."},value:{type:"string",description:"If the action is 'type', then value is the string to type into the text input element. The text input's value will be set to this, so if the element has an existing value from the tag map passed in, make sure to include that in this paramter."}}}}}}execute(){let e=JSON.parse(this.rawArguments),t=this.chatState?.elementMap?.get(e.element),s="";if(t instanceof HTMLElement)switch(e.action){case"click":t.click(),s=`${e.element} was clicked.`;break;case"type":"value"in t?(t.value=e.value||"",s=`${e.value} was typed into ${e.element}.`):s=`${e.element} could not be typed into because it was not an element thay accepts a value like textarea or input.`}else s=`${e.element} could not be located.`;return{name:this.name,arguments:this.rawArguments,result:s}}constructor(e,t,s,r){this.id=e,this.name=t,this.rawArguments=s,this.chatState=r}};var l=s(6786);let ReadDomSkill=class ReadDomSkill{requiresConfirmation(){return!1}confirmationMessage(){return"Read the DOM for the current page"}static schema(){return{type:"function",function:{name:"read-dom",description:"Allows you to interact with the DOM to perform actions like filling out forms, submitting forms, clicking on buttons, and typing into inputs on the current web page. This function requests a list of all interactable elements on the current html page, keyed by their accessible name. If the user makes a request to interact with elements on the current web page, but has not provided any DOM elements in clientToolResults, call this function. After the results are returned, call interact-dom to actually perform the desired interactions. If the user asks a question about the DOM, you can call this to read its state, but do not follow up with an interact-dom call in that case. Finally, let the user know what actions you performed",parameters:{type:"object",properties:{}}}}}execute(){let e={},t=new Map;for(let s of document.querySelectorAll('input, select, textarea, button, [role="button"], a, [tabindex]')){let r=(0,l.G3)(s);t.set(r,s);let a=s.tagName,i=s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement?s.value:null;e[r]={tag:a,value:i}}this.dispatch?.({type:"READ_DOM_SKILL_INVOKED",elementMap:t});let s=JSON.stringify({tagMap:e,url:window.location.href});return{name:this.name,arguments:this.rawArguments,result:s}}constructor(e,t,s,r,a){this.id=e,this.name=t,this.rawArguments=s,this.dispatch=a}};let c={"read-local-workspace-file":s(91441).K,"read-dom":ReadDomSkill,"interact-dom":InteractDomSkill};var d=s(38253),u=s(64575),h=s(96335),p=s(44036),g=s(84569),m=s(10411),E=s(3004),_=s(24538);let UnknownClientSkill=class UnknownClientSkill{requiresConfirmation(){return!1}confirmationMessage(){return"Unknown function"}execute(){return{name:this.name,arguments:this.rawArguments,result:`Unknown function: ${this.name} called with args: ${this.rawArguments}`}}schema(){return{type:"function",function:{name:"unknown-client-skill",description:"This is a fallback skill if the skill is not found"}}}constructor(e,t,s,r,a){this.id=e,this.name=t,this.rawArguments=s,this.chatState=r,this.dispatch=a}};let f="copilot_delete_all_conversations",S="copilot_staff_prompt_dialog",T=null;let CopilotChatManager=class CopilotChatManager{async openChat(e,t,s,r,a){if(this.dispatch({type:"OPEN_COPILOT_CHAT",source:s}),"thread"===t&&await this.findOrStartNewThread(e,a),E.J.setCollapsedState(!1),R(!0),r){let e=new FormData;e.set("copilot_chat_visible","true"),(0,o.DI)(r,{method:"PUT",body:e})}}closeChat(){this.dispatch({type:"CLOSE_COPILOT_CHAT"}),E.J.setCollapsedState(!0),R(!1)}hideChat(e){if(this.dispatch({type:"HIDE_COPILOT_CHAT"}),this.closeChat(),e){let t=new FormData;t.set("copilot_chat_visible","false"),(0,o.DI)(e,{method:"PUT",body:t})}}toggleRepoCustomInstructions(e){this.dispatch({type:"TOGGLE_REPO_CUSTOM_INSTRUCTIONS",value:e}),E.J.setRepoCustomInstructionsState(e)}viewAllThreads(){this.dispatch({type:"VIEW_ALL_THREADS"})}viewCurrentThread(){this.dispatch({type:"VIEW_CURRENT_THREAD"})}async sendChatMessage({thread:e,content:t,references:s,topic:r,context:a,confirmations:i,customInstructions:n,model:o,customCopilotId:l,intent:c=g.wh.conversation,tools:u,clientToolResults:h}){let p=(0,d.P)(r),E=p?void 0:r;return p&&!s.some(e=>"docset"===e.type&&e.name===r.name)&&s.push({type:"docset",name:r.name,id:r.id,avatarUrl:r.avatarUrl,repos:r.repos,description:r.description}),m.W.copilotChatAttachImages&&(s=s.filter(e=>"image"!==e.type)),this.sendNewMessage(e,t,c,s,E,a,i,n,o,l,this.findParentMessageID(),u,h)}findParentMessageID(){if(!m.W.immersiveSubthreading)return"";{let e=(0,p.B)(this.getChatState().messages);return e.findLast(e=>"assistant"===e.role)?.id||"root"}}async retryLastChatMessage(e){let{currentTopic:t,context:s,customInstructions:r,model:a}=this.getChatState(),i=(0,d.P)(t)?void 0:t;return this.resendLastMessage(e,s,i,r,a)}async retryUserChatMessage(e,t){let s;let{currentTopic:r,context:a,customInstructions:i,model:n}=this.getChatState(),o=(0,d.P)(r)?void 0:r;if(t.parentMessageID&&(s=this.getChatState().messages.findLast(e=>e.id===t.parentMessageID)),!s||!s.content)return;this.unselectPreviousChildMessage(s);let l=e.currentReferences||[];return this.sendMessage(e,s.content,l,g.wh.conversation,a,o,i,n,void 0,void 0,s.id)}async editUserChatMessage(e,t,s){let r;let{currentTopic:a,context:i,customInstructions:n,model:o}=this.getChatState(),l=(0,d.P)(a)?void 0:a;if(!s||(t.parentMessage&&(r=t.parentMessage),!r))return;let c=r?.id||"",u=t.clientConfirmations??[],h=e.currentReferences||[],p=(0,d.Y6)({role:"user",content:s,references:h,thread:e,confirmationResponses:u});return p.parentMessageID=c,this.dispatch({type:"MESSAGE_ADDED",message:p,repoHasCustomInstructions:!!l?.customInstructions,usedRepoCustomInstructions:!!(l?.customInstructions&&this.repoInstructionsEnabled())}),this.sendMessage(e,s,h,g.wh.conversation,i,l,n,o,void 0,void 0,c)}setSelectedMessage(e){this.dispatch({type:"MESSAGES_SET_SELECTED_MESSAGE",message:e})}unselectPreviousChildMessage(e){this.dispatch({type:"MESSAGES_UNSELECT_PREVIOUS_MESSAGE",message:e})}async stopStreaming(){this.streamer?(await this.streamer.stop(),this.streamer=void 0):this.messageAbortController?.abort(),this.dispatch({type:"MESSAGE_STREAMING_STOPPED",timings:this.completeTiming()})}async getSystemPrompt(){let{mode:e}=this.getChatState();return await this.systemPrompt(e)}async sendNewMessage(e,t,s,r,a,i,n,o,l,c,u,h,p){let g=(0,d.Y6)({role:"user",content:t,references:r,thread:e,confirmationResponses:n?[n]:[],parentMessageID:u});if(this.dispatch({type:"MESSAGE_ADDED",message:g,repoHasCustomInstructions:!!a?.customInstructions,usedRepoCustomInstructions:!!(a?.customInstructions&&this.repoInstructionsEnabled())}),!e){let s=await this.service.createThread();if(s.ok)e=s.payload,E.J.migrateNullThreadToNewThread(e.id),this.dispatch({type:"THREAD_CREATED",thread:e});else{this.handleSendMessageError(e,w(s.error),t);return}}return this.dispatch({type:"THREAD_UPDATED",thread:{...e,updatedAt:new Date().toISOString()}}),this.unstickyReferencesFeatureEnabled&&this.dispatch({type:"CLEAR_REFERENCES",threadID:e.id}),l&&E.J.setModel(e.id,l),this.sendMessage(e,t,r,s,i,a,o,l,n,c,u,h,p)}async resendLastMessage(e,t,s,r,a){let i=this.getChatState().messages.findLast(e=>"user"===e.role);if(!i?.content)return;let n=e.currentReferences||[];return this.dispatch({type:"MESSAGES_CLEAR_LAST_ERROR"}),this.sendMessage(e,i.content,n,g.wh.conversation,t,s,r,a)}async sendMessage(e,t,s,r,a,i,o,l,c,h,p,g,E){let _=(0,d.Y6)({role:"assistant",content:"",thread:e,parentMessageID:p}),f=g?[...g]:[];this.dispatch({type:"WAITING_ON_COPILOT",loading:!0});let S=s.length&&(1!==s.length||s[0]?.type!=="repository")?void 0:a;(0,n.BI)("copilot.implicit_context",{usedImplicitContext:!!S,type:S?.[0]?.type,count:S?.length}),!s.length&&i&&(s=[(0,d.qS)(i)]);let T=[];i?.customInstructions&&this.repoInstructionsEnabled()&&T.push(i.customInstructions),o&&T.push(o);let{mode:C}=this.getChatState();this.timings={startTime:Date.now()},this.streamer=void 0,this.messageAbortController=new AbortController,m.W.clientDOMSkills&&-1===window.location.href.indexOf("/settings/")&&f.push(ReadDomSkill.schema(),InteractDomSkill.schema());try{let a=await this.service.createMessageStreaming(e.id,t,r,C,s,S??[],c?[c]:[],T,l?.id,h,p,f,E,this.messageAbortController.signal);if(a.ok){let s=a.response.body?.getReader();if(!s){this.handleSendMessageError(e,w(d.DW),t);return}let r=new u.X(s);this.streamer=r,this.dispatch({type:"MESSAGE_STREAMING_STARTED",message:_}),await this.handleStreamingMessage(e,r)}else{if(this.messageAbortController.signal.aborted)return;this.handleSendMessageError(e,w(a.error),t)}}finally{this.streamer=void 0,this.messageAbortController=void 0}}repoInstructionsEnabled(){return(m.W.repoCustomInstructions||m.W.repoCustomInstructionsPreview)&&E.J.getRepoCustomInstructionsState()}addReference(e,t){this.dispatch({type:"ADD_REFERENCE",reference:e,source:t})}removeReference(e){this.dispatch({type:"REMOVE_REFERENCES",referenceIndexes:[e]})}removeReferences(e){this.dispatch({type:"REMOVE_REFERENCES",referenceIndexes:e})}selectModel(e){this.dispatch({type:"SELECT_MODEL",model:e}),E.J.setModel(this.getChatState().selectedThreadID,e)}setCopilotSettings(e){E.J.settings=e}async dismissAttachKnowledgeBaseHerePopover(){this.dispatch({type:"DISMISS_ATTACH_KNOWLEDGE_BASE_HERE_POPOVER"}),await (0,o.DI)("/settings/dismiss-notice/copilot_for_docs_attach_knowledge_base_here",{method:"POST"})}async dismissKnowledgeBaseAttachedToChatPopover(){this.dispatch({type:"DISMISS_KNOWLEDGE_BASE_ATTACHED_TO_CHAT_POPOVER"}),await (0,o.DI)("/settings/dismiss-notice/copilot_for_docs_knowledge_base_attached_to_chat",{method:"POST"})}async selectThread(e,t){let{clearTopic:s,includeThreads:r=!0}=t??{};await this.fetchModels(),await this.stopStreaming(),this.dispatch({type:"SELECT_THREAD",thread:e,clearTopic:s});let a=[];a.push(this.fetchMessages(e?.id||null)),r&&a.push(this.fetchThreads()),await Promise.all(a)}addMessage(e,t,s,r,a,i){let n=(0,d.Y6)({role:e,content:s,references:r,thread:t,confirmationResponses:a,clientSkillConfirmations:i});this.dispatch({type:"MESSAGE_ADDED",message:n})}async renameThread(e,t){(await this.service.renameThread(e.id,t)).ok&&this.dispatch({type:"THREAD_UPDATED",thread:{...e,name:t}})}async clearThread(e){(await this.service.clearThread(e.id)).ok&&this.dispatch({type:"CLEAR_THREAD",threadID:e.id})}async deleteThreadKeepSelection(e){this.dispatch({type:"DELETE_THREAD_KEEP_SELECTION",thread:e});let t=await this.service.deleteThread(e.id);t.ok||this.dispatch({type:"DELETE_THREAD_ERROR",thread:e,error:t.error})}async deleteAllThreadKeepSelection(e){this.dispatch({type:"DELETE_ALL_THREADS_KEEP_SELECTION",threads:e});let t=e.map(e=>e.id);for(let s=0;s<t.length;s+=100){let r=t.slice(s,s+100),a=await this.service.deleteAllThreads({threadIDs:r});a.ok||this.dispatch({type:"DELETE_ALL_THREADS_ERROR",threads:e,error:a.error})}}async deleteThread(e){this.dispatch({type:"DELETE_THREAD",thread:e});let t=await this.service.deleteThread(e.id);t.ok||this.dispatch({type:"DELETE_THREAD_ERROR",thread:e,error:t.error})}generateSuggestions(e){let t="type"in e&&"string"==typeof e.type?e.type:"repository",s=(0,d.mx)(t);this.dispatch({type:"SUGGESTIONS_GENERATED",suggestions:s})}clearSuggestions(){this.dispatch({type:"CLEAR_SUGGESTIONS"})}async handleOpenPanelEvent(e,t,s){let r=t.payload;if(C(r)||y(r,[g.wh.conversation])&&"newThread"in r&&r.newThread?(await this.selectThread(null),e=null):y(r,[g.wh.reviewPr])?(this.addMessage("user",r.thread,i.Bc,r.references),this.addMessage("assistant",r.thread,r.completion,r.references),this.selectThread(r.thread,{includeThreads:!1})):e=await this.findOrStartNewThread(e),this.dispatch({type:"HANDLE_EVENT_START",references:r.references,id:r.id}),y(r,[g.wh.conversation,g.wh.discussFileDiff,g.wh.reviewPr])&&!C(r))return;let a=`blob ${r.intent}`;r.id&&(a=`element ${t.payload.id}`),(0,n.BI)("copilot.open_copilot_chat",{source:a}),await this.sendNewMessage(e,r.content,r.intent,r.references??[],(0,d.Z6)(s)?s:void 0,void 0,void 0,void 0,null,void 0,this.findParentMessageID())}async handleSearchCopilotEvent(e){let t=await this.fetchCurrentRepo(e.repoNwo),s=t?[{type:"repository",...t}]:[];this.openChat(null,"thread","search-bar"),await this.sendNewMessage(null,e.content,g.wh.conversation,s),(0,n.BI)("copilot.open_copilot_chat",{source:"search-bar"})}async handleAddReferenceEvent(e){await this.findOrStartNewThread(),this.addReference(e.reference,"event"),e.openPanel&&this.dispatch({type:"OPEN_COPILOT_CHAT",source:"event",id:e.id})}handleSymbolChangedEvent(e){let t=e.context;this.dispatch({type:"IMPLICIT_CONTEXT_UPDATED",context:[t]})}getSelectedThread(e){return e.selectedThreadID&&e.threads.get(e.selectedThreadID)||null}sortThreads(e){return Array.from(e.values()).sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime())}async sendMessageToNewThread(e,t,s,r){""!==t.trim()&&(e&&(E.J.setSavedMessageFast(e,null),E.J.clearCurrentReferences(e)),await this.sendNewMessage(null,t,g.wh.conversation,s,void 0,r))}async fetchMessages(e){let t=E.J.getCurrentReferences(e);if(!e){this.threadDataLoaded([],t||[]);return}this.dispatch({type:"MESSAGES_UPDATED",state:"loading"});let s=await this.service.listMessages(e);if(s.ok){let e=s.payload.thread;this.threadDataLoaded(s.payload.messages,t||e.currentReferences||[])}else this.dispatch({type:"MESSAGES_UPDATED",state:"error"})}async fetchSharedThreadMessages(e){if(!e)return;this.dispatch({type:"MESSAGES_UPDATED",state:"loading"});let t=await this.service.listSharedThreadMessages(e);t.ok?this.threadDataLoaded(t.payload.messages,[]):this.dispatch({type:"MESSAGES_UPDATED",state:"error"})}selectReference(e){this.dispatch({type:"SELECT_REFERENCE",reference:e})}setTopRepositoryTopics(e){this.dispatch({type:"SET_TOP_REPOSITORIES",topics:e})}async handleStreamingMessage(e,t){try{for await(let s of t.stream())await this.processStreamingMessage(e,s)}catch(s){let t=this.isWrappedStreamingResponseError(s)?this.getStreamingErrorMessage(s.error):w(d.DW);this.handleSendMessageError(e,t);return}}async executeClientSkills(e){let t=await Promise.all(e.map(async e=>{let t=await e.execute();return{id:e.id,type:"function",functionCallResult:t}}));await this.sendChatMessage({thread:this.getSelectedThread(this.getChatState()),content:"",references:[],clientToolResults:t})}isWrappedStreamingResponseError(e){return!!e&&"object"==typeof e&&"error"in e&&!!e.error&&"object"==typeof e.error&&"errorType"in e.error&&"string"==typeof e.error.errorType&&g.C6.includes(e.error.errorType)}generateConfirmationMessage(e){let t="";for(let s of e)t+=`${s.confirmationMessage()}
`;return t}async processStreamingMessage(e,t){var s,r,a;switch((s=this.timings).firstByte??(s.firstByte=Date.now()),t.type){case"content":(r=this.timings).firstToken??(r.firstToken=Date.now()),this.dispatch({type:"MESSAGE_STREAMING_TOKEN_ADDED",token:t.body});break;case"functionCall":a=t.name,g.xP.includes(a)&&this.dispatch({type:"MESSAGE_STREAMING_FUNCTION_CALLED",name:t.name,status:t.status,arguments:t.arguments,errorMessage:t.errorMessage,references:t.references});break;case"clientSkillsRequest":if(m.W.dotcomChatClientSideSkills){let e=this.getChatState(),s=t.toolCalls.map(t=>{let s=c[t.function.name];return s?new s(t.id,t.function.name,t.function.arguments,e,this.dispatch):new UnknownClientSkill(t.id,t.function.name,t.function.arguments,e,this.dispatch)});if(s.some(e=>e.requiresConfirmation())){let r=[{title:"Confirm actions",message:this.generateConfirmationMessage(s),onSubmit:e=>{if(e)this.executeClientSkills(s);else{let e=s.map(e=>{let t={name:e.name,arguments:e.rawArguments,result:"skill could not be executed due to user confirmation rejection"};return{id:e.id,type:"function",functionCallResult:t}});this.sendChatMessage({thread:this.getSelectedThread(this.getChatState()),content:"",references:[],clientToolResults:e})}},confirmation:{toolCalls:t.toolCalls}}];this.addMessage("assistant",this.getSelectedThread(e),"I need your permission to perform the following actions",[],[],r)}else await this.executeClientSkills(s)}break;case"confirmation":this.dispatch({type:"MESSAGE_STREAMING_CONFIRMATION",title:t.title,message:t.message,confirmation:t.confirmation});break;case"complete":this.dispatch({type:"MESSAGE_STREAMING_COMPLETED",messageResponse:t,timings:this.completeTiming()}),await this.handleSendMessageSuccess(e);break;case"error":{let s=this.getStreamingErrorMessage(t);this.handleSendMessageError(e,s);break}case"debug":console.log("Prompt Body:",t.body);break;case"agentError":this.dispatch({type:"AGENT_ERROR",error:{type:t.agentErrorType,code:t.code,message:t.message,identifier:t.identifier}})}}getStreamingErrorMessage(e){switch(e.errorType){case"publicCode":{let e="https://docs.github.com/en/copilot/managing-copilot/managing-copilot-as-an-individual-subscriber/managing-copilot-policies-as-an-individual-subscriber",t=(0,a.jsxs)(a.Fragment,{children:["This response cannot be shown because it references public code, which is restricted by"," ",(0,a.jsx)("a",{href:e,children:"your Copilot settings"}),"."]});return this.hasCEorCBAccess&&(e="https://docs.github.com/en/enterprise-cloud@latest/copilot/managing-copilot/managing-github-copilot-in-your-organization/managing-policies-for-copilot-in-your-organization",t=(0,a.jsxs)(a.Fragment,{children:["This response cannot be shown because it references public code, which is restricted by"," ",(0,a.jsx)("a",{href:e,children:"your organization's Copilot settings"}),"."]})),{type:"basic",isError:!0,message:t,retryable:!1}}case"filtered":return I(d.Sr[403]||d.DW);case"contentTooLarge":return I(d.Sr[413]||d.DW);case"rateLimit":return w(d.Sr[429]||d.DW);case"agentUnauthorized":{let t=JSON.parse(e.description);return{type:"agentUnauthorized",isError:!0,message:`You haven't authorized ${t.name} to access your account. You can do that by going here: ${window.location.origin}/login/oauth/authorize?client_id=${t.client_id}`,details:t}}case"agentRequest":{let t=JSON.parse(e.description);return{type:"agentRequest",isError:!0,message:t.message,details:t}}case"multipleAgentsAttempt":return w("Only one agent is allowed per thread, and their context can't be shared. If you want to interact with another agent, please start a new thread and @ mention the new agent.");case"networkError":return w(d.Sr[408]||d.DW);default:return w(d.DW)}}async handleSendMessageSuccess(e){E.J.setSavedMessageFast(e.id,null),E.J.clearCurrentReferences(e.id),this.dispatch({type:"WAITING_ON_COPILOT",loading:!1}),e=await this.generateThreadName(e),this.dispatch({type:"THREAD_UPDATED",thread:{...e,updatedAt:new Date().toISOString()}})}handleSendMessageError(e,t,s){e&&s&&m.W.copilotChatPersistSubmittedInput&&E.J.setSavedUserMessageOnError(e.id,s);let r=(0,d.Y6)({role:"assistant",content:"",error:t,thread:e});this.dispatch({type:"MESSAGE_ADDED",message:r}),this.dispatch({type:"WAITING_ON_COPILOT",loading:!1}),this.dispatch({type:"MESSAGE_STREAMING_FAILED",timings:this.completeTiming()})}async fetchModels(){if(T){let{availableModels:e}=this.getChatState();(!e||T.length>e.length)&&this.dispatch({type:"MODELS_LOADED",models:T});return}this.dispatch({type:"MODELS_LOADING"});let e=await this.service.listModels();if(e.ok){let t=(0,_.e)(e.payload);T=t,this.dispatch({type:"MODELS_LOADED",models:t});let s=E.J.getModel(this.getChatState().selectedThreadID)?.id,r=t.find(e=>e.id===s);r&&this.dispatch({type:"SELECT_MODEL",model:r})}else this.dispatch({type:"MODELS_LOADING_ERROR",error:e.error})}async acceptModelPolicy(e){e.policy&&"enabled"!==e.policy.state&&(await this.service.setModelPolicyState(e.id,"enabled"),T=null,this.fetchModels())}async fetchThreads(){this.dispatch({type:"THREADS_LOADING"});let e=await this.service.fetchThreads();return e.ok?(setTimeout(()=>this.dispatch({type:"THREADS_LOADED",threads:e.payload}),100),e.payload):(setTimeout(()=>this.dispatch({type:"THREADS_LOADING_ERROR",message:e.error}),100),null)}async fetchLatestThread(e){let t=await this.service.fetchLatestThread(e);return t.ok?(t.payload&&this.dispatch({type:"LATEST_THREAD_LOADED",latestThread:t.payload}),t.payload):null}async findOrStartNewThread(e,t){let s=null;if(e)s=e;else{let e=E.J.selectedThreadID||void 0;s=await this.fetchLatestThread(e)}if(s&&(0,d.F2)(s)&&(s=null),s&&t){let e=await this.service.listMessages(s.id);if(e.ok){let r=e.payload.messages,a=r?.length;a>=2&&!r[a-2]?.references?.find(e=>d.x_(e,t))&&(s=null)}}return await this.selectThread(s,{includeThreads:!1}),s}async generateThreadName(e){if(e.name)return e;let t=await this.service.generateThreadName(e.id);return t.ok&&(e={...e,name:t.payload}),e}async systemPrompt(e){let t=await this.service.getSystemPrompt(e);return t.ok?t.payload.prompt:""}async fetchAgents(e){let t=await this.service.listAgents(e),s=[];return t.ok&&(s=t.payload,this.dispatch({type:"SET_AGENTS",agents:s})),s}async fetchCustomCopilots(){if(!m.W.customCopilots)return[];let e=await this.service.listCustomCopilots(),t=[];return e.ok&&(t=e.payload,this.dispatch({type:"SET_CUSTOM_COPILOTS",customCopilots:t})),t}async fetchCurrentRepo(e){this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"loading"});let t=await this.service.fetchRepo(e);if(t.ok)return this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:t.payload,state:"loaded"}),t.payload;this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"error"})}async fetchKnowledgeBases(){this.dispatch({type:"KNOWLEDGE_BASES_LOADING"});let e=await this.service.listDocsets();return e.ok?this.dispatch({type:"KNOWLEDGE_BASES_LOADED",knowledgeBases:e.payload}):this.dispatch({type:"KNOWLEDGE_BASES_LOADING_ERROR",message:e.error}),e}async fetchImplicitContext(e,t,s){let r=await this.service.fetchImplicitContext(e,t,s);if(r.ok){let e=r.payload?Array.isArray(r.payload)?r.payload:[r.payload]:void 0;this.dispatch({type:"IMPLICIT_CONTEXT_UPDATED",context:e})}}async deleteDocset(e){return(await this.service.deleteDocset(e)).ok}threadDataLoaded(e,t){this.dispatch({type:"MESSAGES_UPDATED",messages:e,state:"loaded"}),this.dispatch({type:"REFERENCES_LOADED",references:t})}dismissEditorUpsellBanner(){let e=new FormData;e.set("copilot_editor_upsell_banner_dismissed","true"),(0,o.DI)("/github-copilot/preferences",{method:"PUT",body:e}),this.dispatch({type:"DISMISS_EDITOR_UPSELL_BANNER"})}completeTiming(){return{...this.timings,endTime:Date.now()}}constructor(e,t,s,r,a,i,n){this.unstickyReferencesFeatureEnabled=m.W.unstickyReferences,this.timings={startTime:0},this.clearCurrentReferences=()=>{this.dispatch({type:"CLEAR_CURRENT_REFERENCES"})},this.clearCurrentTopic=()=>{this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"loaded"})},this.showTopicPicker=(e=!0)=>{this.dispatch({type:"SHOW_TOPIC_PICKER",show:e})},this.dispatch=e,this.service=i??new h.k(t,s,a),this.getChatState=r,this.hasCEorCBAccess=!!n}};function C(e){var t;return y(e,[g.wh.explain,g.wh.suggest])||y(e,[g.wh.conversation])&&"content"in(t=e)&&"string"==typeof t.content}function y(e,t){return new Set(t).has(e.intent)}function w(e){return{isError:!0,message:e,type:"basic",retryable:!0}}function I(e){return{isError:!0,message:e,type:"basic",retryable:!1}}function R(e){let t=document.getElementById(i.fv);t?.setAttribute("aria-expanded",e?"true":"false")}try{(r=Intent).displayName||(r.displayName="Intent")}catch{}},16142:(e,t,s)=>{s.d(t,{T:()=>BlobService});var r=s(85749),a=s(38253),i=s(46335),n=s(51793);let BlobService=class BlobService{async fetchBlob(e,t,s,r,o){try{let l=(0,n.WN)({commitOid:o,owner:t,path:e,pullNumber:s,repo:r}),c=await (0,i.Sr)(l,{method:"GET"});if(c.ok){let e=await c.json();return{status:c.status,ok:!0,payload:e}}return{status:c.status,ok:!1,error:a.DW}}catch{return{status:500,ok:!1,error:a.DW}}}async getBlob(e,t,s,r,a){return this.blobCache.get(e,t,s,r,a)}constructor(){this.blobCache=new r.d(this.fetchBlob)}}},91646:(e,t,s)=>{s.d(t,{kk:()=>a,mL:()=>o,qm:()=>n,sT:()=>r,t:()=>i});let r="open_panel",a="pull_request_review_comment_id",i="initial_path";function n(e){let t=new URL(window.location.href,window.location.origin);t.searchParams.delete(e),window.history.pushState(null,"",t.toString())}function o(e,t,s){let r=new URL(window.location.href,window.location.origin);r.searchParams.set(e,t),s?s(r.searchParams):window.history.pushState(null,"",r.toString())}},51793:(e,t,s)=>{s.d(t,{KD:()=>u,PW:()=>d,WN:()=>h,Wd:()=>i,ic:()=>m,iw:()=>c,sy:()=>g,tH:()=>l,uY:()=>p});var r=s(4227),a=s(91646);let i="edit";function n({owner:e,repo:t,pullNumber:s}){return`/${encodeURIComponent(e)}/${encodeURIComponent(t)}/pull/${s}`}function o({owner:e,repo:t,pullNumber:s}){return`${n({owner:e,repo:t,pullNumber:s})}/${i}`}function l({owner:e,repo:t,pullNumber:s,location:r}){return o({owner:e,repo:t,pullNumber:s})+(r?.search||"")}function c({owner:e,repo:t,pullNumber:s,path:a,location:i}){return`${o({owner:e,repo:t,pullNumber:s})}/file/${(0,r.QU3)(a)}`+(i?.search||"")}function d({owner:e,repo:t,pullNumber:s}){return`${n({owner:e,repo:t,pullNumber:s})}/workspace_editor/suggestions`}function u({owner:e,repo:t,pullNumber:s,pullRequestReviewCommentId:r}){return`${n({owner:e,repo:t,pullNumber:s})}/workspace_editor/suggestions/${r}`}function h({commitOid:e,owner:t,repo:s,pullNumber:r,path:a,location:i}){return`${n({owner:t,repo:s,pullNumber:r})}/workspace_editor/files/${encodeURIComponent(e)}/${encodeURIComponent(a)}`+(i?.search||"")}function p({owner:e,repo:t,pullNumber:s,location:r,path:i}){let n=`${o({owner:e,repo:t,pullNumber:s})}/new`,l=new URLSearchParams(r?.search||"");if(i&&i.includes("/")){let e=i.substring(0,i.lastIndexOf("/")+1);l.set(a.t,e)}return n+(l.toString()?`?${l.toString()}`:"")}function g({owner:e,repo:t,pullNumber:s}){return`${o({owner:e,repo:t,pullNumber:s})}/commit_changes`}function m({owner:e,repo:t,pullNumber:s,analyzeDiffs:r=!1,detectRisk:a=!1}){let i=`${n({owner:e,repo:t,pullNumber:s})}/diff`,o=new URLSearchParams({analyze_diffs:r.toString(),detect_risk:a.toString()});return`${i}?${o.toString()}`}}}]);
//# sourceMappingURL=ui_packages_copilot-chat_utils_copilot-chat-hooks_ts-ui_packages_issue-viewer_utils_queries_ts-8cc34026da43.js.map